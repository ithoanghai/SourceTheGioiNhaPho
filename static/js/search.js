var map,markerData=[],markers=[],districts=[];function initialize(){window.initMap?window.initMap():setTimeout(initialize,200)}function callbackInitMap(){initialize()}districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""}),districts.push({code:"",text:""})

var log = console.log;
new Vue({
    el: '#topSearchForm',
    // delimiters: ["[[", "]]"],
    delimiters: ['${', '}$'],
    template: '#topSearchTemplate',
    data() {
        return {
            isLoading: false,
            isFocus: false,
            suggestions: [],
        }
    },
    props: {
        query: String
    },
    methods: {
        getAutoComplete: () => {
        },
        handleQueryChange: function (e) {
            const q = e.target.value;
            if (q.length == 0) {
                this.isLoading = false;
                this.suggestions = [];
            }
            if (q.length >= 2) {
                this.isLoading = true;
                this.getAutoComplete(q);
            }
        },
        handleFocus: function (e) {
            this.isFocus = !this.isFocus;
        },
        setupAutoComplete: function () {
            clearInterval(this.interval);
            const getHeaderText = (itemType) => {
                switch (itemType) {
                    case 'area':
                        return 'Khu vực';
                    case 'street':
                        return 'Đường';
                    case 'urban_area':
                        return 'Khu dân cư'
                    default:
                        return 'Khu vực'
                }
            }

            this.getAutoComplete = _.debounce(async (q) => {
                const resp = await axios.get(`/api/s-suggest/sell/${q}`)
                if (resp && resp.status && resp.status == 200) {
                    let suggestions = [];
                    let headers = {};
                    for (const item of resp.data) {
                        //hide smaller div
                        //console.log("bigger");
                        if (!(item.type in headers)) {
                            suggestions.push({
                                code: "",
                                text: getHeaderText(item.type),
                                subText: "",
                                link: "",
                                isHeader: true,
                            })
                            headers[item.type] = 1
                        }
                        if (item.sub_type !== 'state') {
                            suggestions.push({
                                code: item.id,
                                text: item.text,
                                subText: item.sub_text,
                                link: "/listings/search?trans_type=${item.type}&keywords=${item.text}",
                                isHeader: false,
                            })
                        }

                    }
                    this.suggestions = suggestions;
                }
                setTimeout(() => {
                    this.isLoading = false;
                }, 200);
                return resp;
            }, 300);
        },
    },
    created() {
       this.interval = setInterval(() => {
           if (window._ && axios) {
               this.setupAutoComplete();
           }
       }, 100)
    }
})

const InfoWindowComponent = Vue.extend({
    template: '#infoWindowTemplate',
    delimiters: ["[[", "]]"],
    props: {
        listing: Object
    },
    methods: {
        getListingDetailURL: function (id) {
            return `/listings/${id}`
        },
    },
});

// new ContactPopUpComponent().$mount('#contactPopUp');
const defaultSliderPriceOptions = {
    type: "double",
    min: 0,
    max: 20,
    from: 0,
    to: 1000,
    step: 0.5,
    grid: true,
    values_separator: "-",
    postfix: "",
    max_postfix: "+",
}
const defaultAreaSliderOptions = {
    type: "double",
    min: 0,
    max: 500,
    from: 0,
    to: 10000,
    step: 0.5,
    grid: true,
    values_separator: "-",
    postfix: "",
    max_postfix: "+",
}

let counter = 0;
const PropertyListComponent = Vue.extend({
    template: '#propertyListTemplate',
    delimiters: ["[[", "]]"],
    props: {
        listings: Array,
        pagination: Object,
        isViewGrid: Boolean,
        Simple: Boolean,
        isLoading: Boolean,
        goTo: Function,
        showContactProject: Function,
    },
    methods: {
        getListingDetailURL: function (id) {
            return `/listings/${id}`
        },
        getDistrict: function (district_code) {
            try {infoWindowTemplate
                return districts.find(item => item.code == district_code).text;
            } catch (e) {
                return '';
            }
        }
    },
})

Vue.component('property-list', PropertyListComponent)

new Vue({
    el: "#search-content",
    delimiters: ['[[', ']]'],
    data() {
        return {
            showFilterType: '',
            showMobileFilter: false,
            houseTypes: houseTypes,
            houseTypeFilter: {},
            minPrice: 0,
            maxPrice: 20,
            minArea: 0,
            maxArea: 500,
            bedroomFilter: [],
            bathroomFilter: '',
            viewtypeFilter: '',
            directionFilters: [],
            isVerifiedFilter: undefined,
            isExclusiveFilter: undefined,
            statusFilters: [],
            isViewGrid: true,
            isFirstLoad: true,
            isLoading: false,
            sortOption: 'priority',
            showSortOptions: false,
            queryParams: new URLSearchParams(window.location.search),
            listings: [],
            pagination: {},
            scriptsReady: false,
            checkingInterval: null,
            showContactPopup: false,
        }
    },
    computed: {
        displayListingNumText: function () {
            return `${this.listings.length} trong số ${this.pagination.total} sản phẩm`;
        },
        filterPriceText: function () {
            if (this.minPrice === 0 && this.maxPrice === 20) {
                return "Khoảng giá";
            } else if (this.minPrice >= 20) {
                return "Trên 20 tỷ";
            } else {
                return `${this.minPrice} - ${this.maxPrice} tỷ`;
            }
        },
        filterAreaText: function () {
            if (this.minArea === 0 && this.maxArea === 500) {
                return "Diện tích";
            } else if (this.minArea >= 500) {
                return "Trên 500 m²";
            } else {
                return `${this.minArea}m² - ${this.maxArea}m²`;
            }
        },
        sortString: function () {
            switch (this.sortOption) {
                case 'price_descend':
                    return 'Giá giảm dần';
                case 'price_ascend':
                    return 'Giá tăng dần';
                case 'created':
                    return 'Mới nhất';
                default:
                    return 'Ưu tiên'
            }
        },
        houseTypeFilterMark: function () {
            return Object.values(this.houseTypeFilter).filter(item => item !== '').length;
        },
        otherFilterMark: function () {
            return this.countOtherFilter();
        },
        mobileFilterMark: function () {
            let curLength = 0;
            if (this.minPrice !== 0 || this.maxPrice !== 20)
                curLength += 1;

            if (this.minArea !== 0 || this.maxArea !== 500)
                curLength += 1;

            if (this.houseTypeFilterMark > 0)
                curLength += this.houseTypeFilterMark;

            if (this.bedroomFilter.length > 0)
                curLength += this.bedroomFilter.length;

            curLength += this.countOtherFilter();

            return curLength
        },
        viewResultsMark: function () {
            let curLength = 0;
            if (this.viewtypeFilter === 'grid' || this.viewtypeFilter === 'list')
                curLength += 1;
            return curLength;
        },
    },
    methods: {
        closeFilterPopup: function (e) {
            const target$ = $(e.target);
            if (!target$.closest(`#${e.data.type}`).length) {
                this.showFilterType = '';
            }
        },
        toggleFilterType: function (type) {
            $(document).off('click.searchFilter');

            if (this.showFilterType !== type) {
                this.showFilterType = type;
            } else {
                this.showFilterType = '';
            }

        },
        toggleMobileFilter: function () {
            if (this.showMobileFilter) {
                $('.main-header').css('z-index', '')
            } else {
                $('.main-header').css('z-index', 0)
            }
            this.showMobileFilter = !this.showMobileFilter;
        },
        resetMobileFilter: function () {

        },
        applyMobileFilter: async function () {
            const priceFrom = this.$mobilePriceSlider.result.from;
            const priceTo = this.$mobilePriceSlider.result.to;
            this.setPrices(priceFrom, priceTo);

            const {from, to} = this.$mobileAreaSlider.result;
            this.setArea(from, to);

            let houseTypeFilter = {...this.houseTypeFilter};
            $('#mobileFilter [name="houseTypeFilter"]:checked').map((index, item) => {
                if (item.value) {
                    houseTypeFilter[item.value] = (item.value);
                }
            });
            this.setHouseFilter(houseTypeFilter);

            this.setOtherFilters($('#mobileFilter'))

            await this.getListings();
            this.setMarkers();
            this.toggleMobileFilter();

        },
        resetHouseFilter: function () {
            let htFilter = {};
            this.houseTypes.map(ht => {
                htFilter[ht.type] = '';
            })
            this.houseTypeFilter = htFilter;
            $('#leads .check').prop('checked', false);
        },
        cancelHouseFilter: function () {
            this.toggleFilterType('houseFilter');
            $('#leads .check').prop('checked', false);
            Object.values(this.houseTypeFilter).map(item => {
                if (item)
                    $(`#leads .check[value=${item}]`).prop('checked', true);
            })
        },
        setHouseFilter: function (houseTypeFilter) {
            if (JSON.stringify(this.houseTypeFilter) === JSON.stringify(houseTypeFilter)) return;
            this.houseTypeFilter = houseTypeFilter;
            const houseFilterItems = Object.values(houseTypeFilter).filter(item => item !== '');
            if (houseFilterItems.length > 0) {
                const houseParam = houseFilterItems.join(',');
                this.updateQueryParams({'house_type': houseParam})
            } else {
                this.removeQueryParams('house_type')
            }
        },
        applyHouseFilter: async function () {
            let houseTypeFilter = {...this.houseTypeFilter};
            $('#houseFilter input[name="houseTypeFilter"]').map((index, item) => {
                if (item.checked) {
                    houseTypeFilter[item.value] = item.value;
                } else {
                    houseTypeFilter[item.value] = '';
                }
            });
            this.setHouseFilter(houseTypeFilter);
            this.toggleFilterType('houseFilter');
            await this.getListings();
            this.setMarkers();
        },
        toggleShowSortOptions: function () {
            this.showSortOptions = !this.showSortOptions;
        },
        setPrices: function (from, to) {
            if (from === undefined || to === undefined) return;
            if (this.minPrice === from && this.maxPrice === to) return;

            let newTo = to;
            let newFrom = from;

            if (newTo >= 20) newTo = 1000;

            if (newFrom >= 20) {
                newFrom = 20;
                newTo = 1000;
            }

            this.minPrice = from;
            this.maxPrice = to;
            this.$priceSlider.update({
                ...this.$priceSlider.options,
                from, to
            });
            this.$mobilePriceSlider.update({
                ...this.$mobilePriceSlider.options,
                from, to
            })
            this.updateQueryParams({minPrice: newFrom, maxPrice: newTo})
        },
        quickSetPrice: async function (from, to) {
            this.setPrices(from, to);
            this.toggleFilterType('priceFilter');
            await this.getListings();
            this.setMarkers();
        },
        resetPriceSlider: function () {
            this.$priceSlider.update(defaultSliderPriceOptions);
            this.$mobilePriceSlider.update(defaultSliderPriceOptions);
        },
        applySliderPrice: async function () {
            const {from, to} = this.$priceSlider.result;
            this.setPrices(from, to);
            this.toggleFilterType('priceFilter');
            await this.getListings();
            this.setMarkers();
        },
        setArea: function (from, to) {
            if (from === undefined || to === undefined) return;
            if (this.minArea === from && this.maxArea === to) return;
            let newTo = to;
            let newFrom = from;

            if (newTo >= 500) newTo = 20000;

            if (newFrom >= 500) {
                newTo = 20000;
            }

            this.minArea = from;
            this.maxArea = to;
            this.$areaSlider.update({
                ...this.$areaSlider.options,
                from, to
            });
            this.$mobileAreaSlider.update({
                ...this.$mobileAreaSlider.options,
                from, to
            });
            this.updateQueryParams({minArea: newFrom, maxArea: newTo})
        },
        quickSetArea: async function (from, to) {
            this.setArea(from, to);
            this.toggleFilterType('acreFilter');
            await this.getListings();
            this.setMarkers();
        },
        resetAreaSlider: function () {
            this.$areaSlider.update(defaultAreaSliderOptions);
            this.$mobileAreaSlider.update(defaultAreaSliderOptions);
        },
        applySliderArea: async function () {
            const {from, to} = this.$areaSlider.result;
            this.setArea(from, to);
            this.toggleFilterType('acreFilter');
            await this.getListings();
            this.setMarkers();
        },
        setOtherFilters: function (parentSelector) {
            let bedFilter = [];
            parentSelector.find('input[name="bedrooms"]:checked').map((index, item) => {
                bedFilter.push(item.value)
            });
            this.setBedroomFilter(bedFilter);

            const bathrooms = parentSelector.find('input[name="bathrooms"]:checked').first().val()
            this.setBathroomFilter(bathrooms);

            let directions = [];
            parentSelector.find('input[name="direction"]:checked').map((index, item) => {
                directions.push(item.value)
            });
            this.setDirectionFilter(directions);

            const isVerified = parentSelector.find('input[name="is_verified"]').first().prop('checked')
            this.setIsVerifiedFilter(isVerified);

            const isExclusive = parentSelector.find('input[name="is_exclusive"]').first().prop('checked');
            this.setIsExclusiveFilter(isExclusive)

            let statuses = []
            parentSelector.find('input[name="status"]:checked').map((index, item) => {
                statuses.push(item.value);
            });
            this.setStatusFilter(statuses);
        },
        applyOthersFilter: async function () {
            this.setOtherFilters($('#otherFilters'));
            this.toggleFilterType('otherFilters');
            await this.getListings();
            this.setMarkers();
        },
        setViewResultsFilters: function (parentSelector) {
            const asview = parentSelector.find('input[name="asView"]:checked').first().val()
            if (!asview) return;
            if (this.viewtypeFilter === asview) return;
            this.viewtypeFilter = asview;
            if (asview !== 'grid'){
                this.updateQueryParams({'asview': asview});
                this.viewAsList()
            }
            else{
                this.removeQueryParams('asview');
                this.viewAsGrid()}
        },
        applyViewResultsFilter: async function () {
            alert('alo');
            this.setViewResultsFilters($('#viewResults'));
            this.toggleFilterType('viewResults');
            /*await this.getListings();*/
            alert('blo');
        },
        setBedroomFilter: function (filters) {
            if (!filters) return;
            if (JSON.stringify(this.bedroomFilter) === JSON.stringify(filters)) return;
            this.bedroomFilter = filters;
            this.updateQueryParams({'bedrooms': filters})
        },
        setBathroomFilter: function (filter) {
            if (!filter) return;
            if (this.bathroomFilter === filter) return;
            this.bathroomFilter = filter;
            if (filter !== 'all')
                this.updateQueryParams({'bathrooms': filter})
            else
                this.removeQueryParams('bathrooms')
        },
        setDirectionFilter: function (filters) {
            if (!filters) return;
            if (JSON.stringify(this.directionFilters) === JSON.stringify(filters)) return;

            this.directionFilters = filters;
            this.updateQueryParams({'directions': filters})
        },
        setIsVerifiedFilter: function (value) {
            if (this.isVerifiedFilter === value) return;
            this.isVerifiedFilter = value;
            if (value === true) {
                this.updateQueryParams({'is_verified': value});
            } else {
                this.removeQueryParams('is_verified')
            }
        },
        setIsExclusiveFilter: function (value) {
            if (this.isExclusiveFilter === value) return;
            this.isExclusiveFilter = value;
            if (value === true) {
                this.updateQueryParams({'is_exclusive': value});

            } else {
                this.removeQueryParams('is_exclusive')
            }
        },
        setStatusFilter: function (filters) {
            if (!filters) return;
            if (JSON.stringify(this.statusFilters) === JSON.stringify(filters)) return;
            this.statusFilters = filters;
            this.updateQueryParams({'status': filters})
        },
        sortBy: async function (sortOption) {
            if (this.sortOption == sortOption) return;
            this.sortOption = sortOption;
            this.showSortOptions = false;
            this.updateQueryParams({sort: sortOption});
            await this.getListings();

            const sort_price_ascend = (a, b) => a.price - b.price;
            const sort_price_descend = (a, b) => b.price - a.price;
            const sort_priority = (a, b) => a.priority - b.priority;
            const sort_created = (a, b) => a.list_date - b.list_date;

            switch (sortOption) {
                case 'price_ascend':
                    this.listings.sort(sort_price_ascend)
                    break;
                case 'price_descend':
                    this.listings.sort(sort_price_descend)
                    break;
                case 'created':
                    this.listings.sort(sort_created)
                    break;
                default:
                    this.listings.sort(sort_priority)
                    break;
            }

            this.setMarkers();
        },
        countOtherFilter: function () {
            let curLength = 0;
            if (this.bathroomFilter && this.bathroomFilter !== 'all')
                curLength += 1;

            if (this.bedroomFilter.length > 0)
                curLength += this.bedroomFilter.length;

            if (this.directionFilters.length > 0)
                curLength += this.directionFilters.length;

            if (this.isVerifiedFilter === true)
                curLength += 1;

            if (this.isExclusiveFilter === true)
                curLength += 1;

            if (this.statusFilters.length > 0)
                curLength += this.statusFilters.length;

            return curLength;
        },
        viewAsGrid: async function () {
            this.isViewGrid = true;
        },
        viewAsList: async function () {
            this.isViewGrid = false;
        },
        viewAsSimple: async function () {
            this.isViewGrid = false;
        },
        getQueryParams: function () {
            return this.queryParams;
        },
        updateQueryParams: function (params) {
            const urlParams = this.getQueryParams();
            Object.keys(params).map((key) => {
                if (urlParams.has(key)) {
                    urlParams.set(key, params[key])
                } else {
                    urlParams.append(key, params[key])
                }
            })
            this.queryParams = urlParams;
        },
        removeQueryParams: function (key) {
            if (this.queryParams.has(key))
                this.queryParams.delete(key)
        },
        getListings: async function () {
            this.isLoading = true;
            const urlParams = this.getQueryParams();
            try {
                const resp = await axios.get(`/api/search?${urlParams.toString()}`)
                if (resp && resp.status === 200) {
                    const {listings, pagination, sortOption} = resp.data;
                    this.listings = listings;
                    this.pagination = pagination;
                    this.sortOption = sortOption;
                }
            } catch (e) {
                this.listings = [];
                this.pagination = {};
            }

            this.isLoading = false;
        },
        goTo: async function (page) {
            this.updateQueryParams({page})
            await this.getListings();
            this.setMarkers();
        },
        applySearchParams: async function () {

        },
        showContactProject: function () {
            this.showContactPopup = true;
        },
        closeContactProject: function () {
            this.showContactPopup = false;
        },
        setMarkers: function () {
            if (!map) return;
            this.listings.map((item, index) => {
                const marker = new google.maps.Marker({
                    position: new google.maps.LatLng(item.lat, item.long),
                    title: item.title,
                    map: map,
                    icon: normalIcon(),
                })
                google.maps.event.addListener(marker, 'click', (e) => this.openInfoWindow(index))
                markers.push(marker);
            })
        },
        openInfoWindow: function (index) {
            if (!index || !this.listings.length || this.listings.length < index) return;
            const listing = this.listings[index];
            const instance = new InfoWindowComponent({
                propsData: {
                    listing
                }
            })
            instance.$mount();
            const infoWindow = new google.maps.InfoWindow({
                content: instance.$el
            })
            infoWindow.open(map, markers[index])

            setTimeout(() => {
                instance.$destroy();
            }, 500)
        },
        initMap: function () {
            if (!google) return;
            const mapOptions = {
                zoom: 12,
                center: new google.maps.LatLng(21.0334474, 105.8401439),  // Hanoi
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            map = new google.maps.Map(document.getElementById('search-map'), mapOptions);
        },
        clearMarkers: function () {
            for (let i = 0; i < markers.length; i++) {
                markers[i].setMap(null)
            }
            markers = [];
        },
        checkIntervalCallback: function () {
            if (axios) {
                this.scriptsReady = true;
            }
            counter++;
            if (counter >= 20) {
                clearInterval(this.checkingInterval);
            } else {
                clearInterval(this.checkingInterval);
                const timeout = 200 + counter * 40;
                this.checkingInterval = setInterval(this.checkIntervalCallback, timeout);
            }
        }
    },
    created() {
        this.checkingInterval = setInterval(this.checkIntervalCallback, 200);
        window.initMap = this.initMap;

        let htFilter = {};
        this.houseTypes.map(ht => {
            htFilter[ht.type] = '';
        })
        this.houseTypeFilter = htFilter;
    },
    mounted() {
        setTimeout(() => {
            $(this.$refs.priceInput).ionRangeSlider(defaultSliderPriceOptions);
            $(this.$refs.mobilePriceInput).ionRangeSlider(defaultSliderPriceOptions);
            this.$priceSlider = $(this.$refs.priceInput).data('ionRangeSlider');
            this.$mobilePriceSlider = $(this.$refs.mobilePriceInput).data('ionRangeSlider');

            $(this.$refs.areaInput).ionRangeSlider(defaultAreaSliderOptions);
            $(this.$refs.mobileAreaInput).ionRangeSlider(defaultAreaSliderOptions);
            this.$areaSlider = $(this.$refs.areaInput).data('ionRangeSlider');
            this.$mobileAreaSlider = $(this.$refs.mobileAreaInput).data('ionRangeSlider');
        }, 100);
    },
    watch: {
        scriptsReady: async function () {
            clearInterval(this.checkingInterval);
            await this.getListings();
            this.setMarkers();
        },
        showFilterType: async function () {
            if (this.showFilterType) {
                $(document).on('click.searchFilter', {type: this.showFilterType}, this.closeFilterPopup)
            }
        }
    },
    destroyed: function () {
        this.$priceSlider.destroy()
    }
})

