{% extends 'base.html' %}

{% load static humanize i18n get_cadastral load_static listing %}

{% block head %}
  {{ block.super }}

  <link rel="canonical" href="{{ listing.id }}"/>

{% endblock %}

{% block head_script %}

  <link rel="stylesheet" href="{% load_static 'css/listing-detail-page.css' %}"/>
  <style>
      img.fade {
          transition: opacity 500ms ease-in-out;
          opacity: 0;
      }

      img.fade.loaded {
          background: none;
          opacity: 1;
      }
  </style>

  <style>
      .detail-content-news img:before, .thumb-duan img:before, .cover img:not([src]):before {
          background-image: none !important;
      }

      .info-sketch {
          height: auto;
          min-height: 190px;
      }

      @media screen and (max-width: 480px) {
          .info-sketch {
              padding-top: 20px;
          }

          .floorplan-property .content {
              padding-bottom: 0;
          }
      }

      .gallery-property div img {
          object-fit: cover;
          object-position: center;
      }
  </style>

  <style>
      .gmap-render.full-screen {
          max-width: 100% !important;
      }

      ._map-bg {
          background: url({% static 'images/map-detail.png' %}) center / cover no-repeat;
          cursor: pointer;
          width: 100%;
          height: 100%;
          z-index: 2;
      }

      /*Mặc định sẽ ẩn map render*/
      .map-detail .map-wrapper {
          display: none
      }

      /* Khi fullscreen thì sẽ hiện map render lên */
      .map-detail.full-screen .map-wrapper {
          display: block;
          position: relative;
          width: 100%;
          height: 100%;
      }

      /* Khi fullscreen thì ẩn cái ảnh map đi */
      .map-detail.full-screen .img-map {
          display: none
      }

      /* Mặc định sẽ ẩn nút fullscreen đi */
      .map-wrapper .full-screen-act {
          display: none
      }

      /* Và sẽ hiện fullscreen khi đang ở chế độ fullscreen */
      .map-detail.full-screen .full-screen-act {
          display: block
      }
  </style>

  <style>

  </style>
{% endblock %}

{% block content %}
  <!-- Search menu -->
  {% include 'partials/_menuSearch.html' %}
  {% for message in messages %}
    <div class="alert {{ message.tags }} alert-dismissible " role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      <p class="alert-message blink"> {{ message }}</p>
      {#      {{ message }}#}
    </div>
  {% endfor %}

  <div id="wrap">
    <div class="banner-app-tgnp" id="tgnp-banner-prompt" style="display: none">
      <div class="banner-app-content">
        <button onclick="AppPrompt.closePrompt()" class="close-banner-app">
          <i class="zmdi zmdi-close"></i>
        </button>
        <a href="javascript:void(0)" class="cover">
          <img src="{% static 'img/logo.svg' %}" alt="Thế giới Nhà Phố">
        </a>
        <div class="banner-app-info">
          <a href="javascript:void(0)">TGNP</a>
          <p>Mua bán nhà dễ dàng</p>
          <div class="rating-star">
            <i class="zmdi zmdi-star evaluated"></i>
            <i class="zmdi zmdi-star evaluated"></i>
            <i class="zmdi zmdi-star evaluated"></i>
            <i class="zmdi zmdi-star evaluated"></i>
            <i class="zmdi zmdi-star-half evaluated"></i>
          </div>
        </div>
      </div>
      <a href="javascript:void(0)" class="btn-install">Mở</a>
    </div>

    <input name="recent-view-property-id" type="hidden" value="{{ listing.id }}">
    <input name="recent-view-service-type" type="hidden" value="{{ listing.transaction_type }}">
    <div class="background-detail mpreviews">
      <form name="info" class="hidden">
        <input name="id" type="hidden" value="{{ listing.id }}">
        <input name="source" type="hidden" value="tgnp">
        <input name="rvid" type="hidden" value="{{ listing.code }}">
        <input name="title" type="hidden" value="{{ listing.title }}">
        <input name="price" type="hidden" value="{{ listing.price }}">
        <input name="thumbnail" type="hidden"
               value="{% with listing.main_photo as photo %}{{ photo.url }}{% endwith %}">
        <input name="price-format" type="hidden" value="{{ listing.price }} tỷ">
        <input name="num-bed-room" type="hidden" value="{{ listing.bedrooms }}">
        <input name="num-bath-room" type="hidden" value="{{ listing.bathrooms }}">
        <input name="sale-status" type="hidden" value="{{ listing.is_published }}">
        <input name="agent-avatar" type="hidden" value="{% static 'img/logo.svg' %}">
        <input name="agent-id" type="hidden" value="id-{{ listing.id }}">
        <input name="agent-name" type="hidden" value="thegioinhaphovietnam.com.vn">
        <input name="agent-encoded" type="hidden" value="">
        <input name="agent-job-title" type="hidden" value="Hỗ trợ 24/7">
        <input name="agent-phone" type="hidden" value="0916 286 256">
        <input name="contact" type="hidden" value="0916 286 256">
        <input name="area" type="hidden" value="{{ listing.area }}">
        <input name="service-type" type="hidden" value="">
        <input name="property-type" type="hidden" value="">
        <input name="direction" type="hidden" value="{{ listing.direction }}">
        <input name="street" type="hidden" value="{{ listing.street }}">
        <input name="ward" type="hidden" value="{{ listing.ward }}">
        <input name="district" type="hidden" value="{{ listing.district }}">
        <input name="city" type="hidden" value="{{ listing.state }}">
        <input name="neighborhood" type="hidden" value="">
        <input name="lat" type="hidden" value="">
        <input name="lon" type="hidden" value="">
        {#        <input name="youtube" type="hidden" value="{{ listing.videos.0.video }}">#}
        <input name="favorited_type" type="hidden" value="sale_property">
        <input name="streetviewLat" type="hidden" value="">
        <input name="streetviewLon" type="hidden" value="">
      </form>
      <div class="mphotos height-100-percent">
        <div id="slider" class="flexslider">
          <div class="group-share">
            <a href="#" style="opacity: 0.3" data-id="{{ listing.id }}" data-action="favorite"
               data-alias="{{ listing.title }}"
               data-type="sale_property" class="" data-favorited="false">
              <i class="zmdi zmdi-favorite-outline"></i>
              <span>Yêu thích</span>
            </a>
          </div>
          <div class="slider-buttons">
            <a href="#"><span class="but-nextdetail flex-next"></span></a>
            <a href="#"><span class="but-predetail flex-prev flex-disabled" tabindex="-1"></span></a>
          </div>
          <div class="flex-viewport">
            <ul class="slides">
              {% for photo in listing.photos %}
                <li>
                  <a href="#" class="cover">
                    {% if forloop.first %}
                      <img class="image-normalized"
                           src="{{ photo.url }}"
                           alt="{{ listing.title }}"
                           title="{{ listing.title }}"
                           draggable="false"/>
                    {% else %}
                      <img class="lazy fade image-normalized"
                           data-src="{{ photo.url }}"
                           alt="{{ listing.title }}"
                           title="{{ listing.title }}"
                           draggable="false"/>
                    {% endif %}

                  </a>
                </li>
              {% empty %}
                <li>
                  <img class="lazy fade image-normalized"
                       data-src="{% static 'img/default.png' %}"
                       alt="{{ listing.title }}"
                       title="{{ listing.title }}"
                       draggable="false"/>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      <div class="mvideo height-100-percent">
        <video
          id="listing-video"
          class="video-js vjs-default-skin hidden"
          controls
          preload="auto"
          data-setup="{'techOrder': ['youtube'],}"
        >
          {% for video in listing.videos %}
            <source src="{{ video.video }}" type="video/youtube">
          {% endfor %}
        </video>
        {#        <iframe id="preview-video" frameborder="0" allowfullscreen>#}
        {##}
        {#        </iframe>#}
      </div>
      <div class="mview3d preview3d hidden height-100-percent">
        <a href="#" class="full-screen-act" title="Fullscreen"></a>
        <iframe frameborder="0" allow-fullscreen=""></iframe>
      </div>
      <div class="mstreetview hidden height-100-percent">
        <div id="preview-streetview"></div>
      </div>
      <div class="fullscreen-slide preview">
        <a href="#" class="full-screen-act close" title="Fullscreen"></a>
        <div id="slider8" class="flexslider fullscreen">
          <div class="slider-buttons">
            <a href="#" title="next"><span class="but-nextdetail flex-next"></span> </a>
            <a href="#" title="prev"><span class="but-predetail flex-prev"></span> </a>
          </div>
          <ul class="slides">
            {% for photo in listing.photos %}
              <li>
                <a href="#" class="cover"
                   title="{{ listing.title }}">
                  <img src="{{ photo.url }}"
                       pos="0"
                       alt="{{ listing.title }}"
                       title="{{ listing.title }}">
                </a>
              </li>
            {% empty %}
              <li>
                <img src="{% static 'img/default.png' %}"
                     pos="0"
                     alt="{{ listing.title }}"
                     title="{{ listing.title }}">
              </li>
            {% endfor %}
          </ul>
        </div>
        <div id="carousel1" class="flexslider img-list-slide">
          <ul class="slides slideimg">
            {% for photo in listing.photos %}
              <li>
                <a class="img cover" href="#" title="{{ listing.title }}">
                  {% if forloop.first %}
                    <img class="lazy image-normalized fade"
                         src="{{ photo.url }}"
                         alt="{{ listing.title }}"
                         title="{{ listing.title }}"/>
                  {% else %}
                    <img class="lazy image-normalized fade"
                         data-src="{{ photo.url }}"
                         alt="{{ listing.title }}"
                         title="{{ listing.title }}"/>
                  {% endif %}
                </a>
              </li>
            {% empty %}
              <li>
                <img class="lazy image-normalized fade" src="{% static 'img/default.png' %}"
                     data-src="{% static 'img/default.png' %}"
                     alt="{{ listing.title }}"
                     title="{{ listing.title }}"/>
              </li>
            {% endfor %}
          </ul>
          <div class="slider-buttons2">
            <a class="font-icon icon-presmall flex-prev" href="#" title="prev"></a>
            <a class="font-icon icon-nextsmall flex-next" href="#" title="next"></a>
          </div>
        </div>
      </div>

    </div>
    <div class="changeimg-box">
      <div class="fix-widthcell">
        <div id="carousel" class="flexslider">
          <div class="slider-buttons2">
            <a class="font-icon icon-presmall flex-prev flex-disabled" href="#" tabindex="-1"
               title="prev"></a>
            <a class="font-icon icon-nextsmall flex-next" href="#" title="next"></a>
          </div>
          <div class="flex-viewport">
            <ul class="slides slideimg">
              {% for photo in listing.photos %}
                <li class="flex-active-slide">
                  <a class="img cover" href="javascript:void(0)"
                     title="{{ listing.title }}">
                    <img class="lazy image-normalized fade"
                         data-src="{{ photo.url }}"
                         title="{{ listing.title }}"
                         alt="{{ listing.title }}"
                         draggable="false">
                  </a>
                </li>
              {% empty %}
                <li class="flex-active-slide">
                  <img class="lazy image-normalized fade"
                       data-src="{% static 'img/default.png' %}"
                       title="{{ listing.title }}"
                       alt="{{ listing.title }}"
                       draggable="false">
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
        <ul class="naviicon">
          <li class="active ">
            <a href="#photos" title="Photo" no-prevent>
              <span class="font-icon photo"></span> Photo
            </a>
          </li>
          <li class="{% if not listing.videos %}disable{% endif %}">
            <a href="#video" title="Video" no-prevent>
              <span class="font-icon video"></span> Video
            </a>
          </li>
          {#                    <li class="">#}
          {#                        <a href="#view3d" title="3D view" no-prevent>#}
          {#                            <span class="font-icon view3d"></span> 3D view#}
          {#                        </a>#}
          {#                    </li>#}
          {#                    <li class="">#}
          {#                        <a href="#streetview" title="Street view" no-prevent>#}
          {#                            <span class="font-icon streetview"></span> Street view#}
          {#                        </a>#}
          {#                    </li>#}
        </ul>
      </div>
    </div>
    <section class="page-listing-detail">
      <div class="width1140">
        <div class="left-content">
          <div class="content-detail-house">
            <header class="detail-house">
              <div class="address">
                {% if listing.urban_area %}
                  <h2><a href="{% url 'listing_search' %}?urban_area={{ listing.urban_area }}"
                         title="Khu đô thị/ khu dân cư">{{ listing.urban_area }}</a></h2>
                {% endif %}
                <h2><a href="{% url 'listing_search' %}?street={{ listing.street }}"
                       title="Đường">{{ listing.street }}</a></h2>
                {% if listing.ward %}
                  <h2><a href="{% url 'listing_search' %}?ward={{ listing.ward }}"
                         title="Phường/Xã">{{ listing.ward_name }}</a></h2>
                {% endif %}
                <h2><a href="{% url 'listing_search' %}?district={{ listing.district }}"
                       title="Quận/Huyện">{% get_district listing.district %}</a></h2>
                <h2><a href="{% url 'listing_search' %}?state={{ listing.state }}"
                       title="Tỉnh/Thành phố">{% get_state listing.state %}</a></h2>

              </div>
              <h2>{{ listing.title }}</h2>
              <div class="detail-row">
                <ul class="detailroom">
                  <li title="Diện tích"><span
                    class="zmdi zmdi-photo-size-select-small"></span> {{ listing.area }} m2
                  </li>
                  <li title="Giá"><strong>$</strong><b>{{ listing.price }} tỷ</b></li>
                  {% if listing.sale_price  and listing.sale_price < listing.price %}
                    <li title="Bán nhanh"><strong>Bán nhanh {{ listing.sale_price }} tỷ </strong></li> {% endif %}
                </ul>
                <div class="listing-id">
                  <span>Mã nhà đất: </span>
                  <span style="padding-left: 0px">{{ listing.code }}</span>
                </div>
              </div>
            </header>
          </div>
          <div class="heading-02">Mô tả ngắn</div>
          <div class="content collapsed pdb-0" data-height="150">
            <p class="summary">{{ listing.description }}</p>
          </div>
          <p class="more">
            <a href="#" title="Xem thêm / thu gọn" class="collapse" is-more="true" more="Xem thêm"
               less="Thu gọn">Xem thêm</a>
          </p>
          <div class="heading-02">Thông tin cơ bản</div>
          <div class="content">
            <ul class="detail-more">
              <li>
                <p class="left">Loại hình</p>
                <p class="right"><a href="{% url 'listing_search' %}?house_type={{ listing.house_type }}"
                                    target="_blank">
                  {% if listing.house_type == 'town_house' %}{% translate 'Nhà Phố' %}
                  {% elif listing.registration_type == 'street_house' %} {% translate 'Nhà mặt phố' %}
                  {% elif listing.registration_type == 'shop_house' %} {% translate 'Cửa hàng' %}
                  {% elif listing.registration_type == 'building' %} {% translate 'Toà nhà' %}
                  {% elif listing.registration_type == 'apartment' %} {% translate 'Căn hộ CC' %}
                  {% elif listing.registration_type == 'villa' %} {% translate 'Biệt thự' %}
                  {% elif listing.registration_type == 'office' %} {% translate 'Văn phòng' %}
                  {% else %} {% translate 'Đất' %}  {% endif %}
                </a></p>
              </li>
              <li>
                <p class="left">Số tầng</p>
                <p class="right">{% if listing.floors %}{{ listing.floors }}{% else %} 0 {% endif %}</p>
              </li>
              <li>
                <p class="left">Số phòng ngủ</p>
                <p class="right">{{ listing.bedrooms }}</p>
              </li>
              <li>
                <p class="left">Số phòng tắm</p>
                <p class="right">
                  {% if listing.bathrooms %}{{ listing.bathrooms }}{% else %} 0 {% endif %}</p>
              </li>
              <li>
                <p class="left">Diện tích</p>
                <p class="right">{{ listing.area }} {{ listing.area_unit }}</p>
              </li>
              {% if listing.lot_size %}
                <li>
                  <p class="left">Diện tích khuân viên</p>
                  <p class="right">{{ listing.lot_size }}</p>
                </li>
              {% endif %}
              <li>
                <p class="left">Loại chứng nhận</p>
                <p class="right"><a
                  href="{% url 'listing_search' %}?registration_type={{ listing.registration_type }}"
                  target="_blank">
                  {% if listing.registration_type == 'red_book' %}{% translate 'Sổ đỏ' %}
                  {% elif listing.registration_type == 'pink_book' %} {% translate 'Sổ hồng' %}
                  {% else %} {% translate 'Chưa làm sổ' %}  {% endif %}</a></p>
              </li>
              <li>
                <p class="left">Giá bán</p>
                <p class="right">{{ listing.price }} tỷ</p>
              </li>
              {% if listing.sale_price %}
                <li>
                  <p class="left">Bán nhanh</p>
                  <p class="right">{{ listing.sale_price }} tỷ</p>
                </li>
              {% endif %}
            </ul>
          </div>
          <div class="form-real-estate visible-sm">
            <div class="heading-02">Liên hệ tư vấn</div>
            <div class="form-real-estate__row">
              <div class="col-left">
                <div class="cover__isa">
                  <img class="lazy" data-src="{% static 'images/isa-team-v2.png' %}" alt="tgnp">
                </div>
                <h5 class="advisory__title">Chuyên viên đã sẵn sàng hỗ trợ!</h5>
              </div>
              <a style="opacity: 0.3" href="javascript:void(0)"
                 class="btn-contact-me btn-primary btn-black btn-form-real-estate">Yêu cầu liên hệ lại</a>
            </div>
          </div>
          <div id="booking-form-sm-wrapper"></div>

          <div class="heading-02">Ưu điểm ngôi nhà</div>
          <div class="content">
            <div class="list-advantage clear">
              <div class="advantage-name">
                <p>Tag</p>
              </div>
              <div class="advance-date-content">
                <div class="tag-news pd-0">
                  <span>{{ listing.house_type }} {{ listing.district }}</span>
                  <span>{{ listing.house_type }} {{ listing.floors }} tầng</span>
                  <span>{{ listing.house_type }} {{ listing.bedrooms }} phòng ngủ</span>
                </div>
              </div>
            </div>
            {% if listing.salient_features %}
              <div class="list-advantage clear">
                <div class="advantage-name">
                  <p>Đặc điểm nổi bật</p>
                </div>
                <div class="advance-date-content">{{ listing.salient_features }}</div>
              </div>
            {% endif %}
            {% if listing.location_advantage %}
              <div class="list-advantage clear">
                <div class="advantage-name">
                  <p>Ưu điểm vị trí</p>
                </div>
                <div class="advance-date-content">{{ listing.location_advantage }}</div>
              </div>
            {% endif %}
            {% if listing.furniture_included %}
              <div class="list-advantage clear">
                <div class="advantage-name">
                  <p>Nội thất kèm theo</p>
                </div>
                <div class="advance-date-content">{{ listing.furniture_included }}</div>
              </div>
            {% endif %}
            {% if listing.living_facilities %}
              <div class="list-advantage clear">
                <div class="advantage-name">
                  <p>Tiện ích sinh hoạt</p>
                </div>
                <div class="advance-date-content">{{ listing.living_facilities }}</div>
              </div>
            {% endif %}
            {% if listing.residential_community %}
              <div class="list-advantage clear">
                <div class="advantage-name">
                  <p>Cộng đồng dân cư</p>
                </div>
                <div class="advance-date-content">{{ listing.residential_community }}</div>
              </div>
            {% endif %}
            {% if listing.regional_welfare %}
              <div class="list-advantage clear">
                <div class="advantage-name">
                  <p>An sinh khu vực</p>
                </div>
                <div class="advance-date-content">{{ listing.regional_welfare }}
                </div>
              </div>
            {% endif %}
            <div class="list-advantage clear">
              <div class="advantage-name">
                <p>Tình trạng BĐS</p>
              </div>
              <div class="advance-date-content">{% if listing.status == 'selling' %} {% trans 'Đang bán' %}
              {% elif listing.status == 'sold' %} {% trans 'Đã bán' %}
              {% elif listing.status == 'stop_selling' %} {% trans 'Dừng bán' %}
              {% else %} {% trans 'Mới' %}
              {% endif %}
              </div>
            </div>
          </div>

          {% comment %}<div class="heading-02">Tiện ích</div>
          <div id="details-amenities" class="content collapsed">
            <ul class="detail-more">
              <li><p class="left">Ban công</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Phòng cho giúp việc</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Sân vườn</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Phòng giải trí</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Chỗ đậu xe hơi</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Hồ bơi riêng</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Quầy minibar</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Tầng hầm</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Góc làm việc</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Nhà kho</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Nuôi thú cưng</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Gym</p>
                <p class="right zmdi zmdi-close"></p>
              </li>


            </ul>
          </div>
          <p class="more">
            <a href="#" title="Xem thêm / thu gọn" class="collapse" is-more="true" more="Xem thêm"
               less="Thu gọn">Xem thêm</a>
          </p>

          <div class="heading-02">Thiết bị, dịch vụ</div>
          <div id="details-furniture" class="content collapsed">
            <ul class="detail-more">
              <li><p class="left">TV</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Máy hút mùi</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Cảm biến cháy</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Tủ lạnh</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Bếp ga, bếp từ</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Máy giặt</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Máy sấy</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Dàn phơi đồ thông minh</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Máy lạnh</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Máy nước nóng</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Khóa cửa thẻ từ</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Khóa cửa mật khẩu</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Khóa cửa vân tay</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Thiết bị âm thanh</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Smart Home</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Lò nướng</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Lò vi sóng</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Camera an ninh</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Internet</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Truyền hình cáp</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
            </ul>
          </div>
          <p class="more">
            <a href="#" title="Xem thêm / thu gọn" class="collapse" is-more="true" more="Xem thêm"
               less="Thu gọn">Xem thêm</a>
          </p>{% endcomment %}

          <div class="heading-02">Hình ảnh</div>
          <div class="gallery-property collapsed" data-height="900">
            {% for photo in listing.photos %}
              <div class="cover">
                <a href="#" title="{{ listing.title }}">
                  <img class="lazy fadeout"
                       data-src="{{ photo.url }}"
                       alt="{{ listing.title }}"
                       title="{{ listing.title }}">
                  <span>Hình sản phẩm</span>
                </a>
              </div>
            {% endfor %}
            <div class="last-div"></div>
          </div>
          <p class="view-more-gray more">
            <a href="#" title="Xem thêm / thu gọn" style="text-underline: none" class="collapse pdt-0"
               is-more="true" more="Xem thêm" less="Thu gọn">Xem tất cả</a>
          </p>
          <div class="heading-02">Bản đồ khu vực</div>
          <section class="mgt-15 map-detail gmap-render">
            {#            background-image: url(https://maps.googleapis.com/maps/api/js?key=AIzaSyAWKbev18w2O63PfjhgpyU6DWvL6G4DCCc&libraries=drawing,places,geometry&language=vi&callback=callbackInitMap)#}
            <div class="_map-bg openBtn img-map"
                 style="">
              <img src="{{ listing.id|location_image }}"
                   title="{{ listing.code }}" alt="{{ listing.title }}"/>
              {% comment %}<div class="tooltip-map">
                <a>Nhấn vào để xem chi tiết</a>
              </div>{% endcomment %}
              <div class="map--address">
                <div class="address-property">
                  <div class="left-100"><i class="zmdi zmdi-hc-2x zmdi-pin rever-red"></i>
                    <strong>{{ listing.title }}</strong>
                  </div>
                </div>
              </div>
            </div>

            <div class="map-wrapper">
              <a href="" class="full-screen-act" title="Fullscreen"></a>
              <div id="render-map"></div>
              <div class="cover-nearby">
                <div class="nearby">
                  <div class="parent-content">
                    <form name="search-nearby">
                      <input type="text" id="nearby-search" class="" autocomplete="on"
                             spellcheck="false" dir="auto"
                             placeholder="Tìm kiếm địa điểm gần đây">
                    </form>
                    <div class="title">
                      <span>Bản đồ</span>
                      <div class="list-icon traffic-type">
                      </div>
                    </div>
                    <ul class="content directions pdb-0">
                    </ul>
                    <div class="title">Địa điểm gần nhất</div>
                    <ul class="type checkbox nearby-places">
                    </ul>
                  </div>
                </div>
                <div class="icon-left-nearby ">
                  <a class="location" href="#" title="Vị trí của BĐS"></a>
                  <a class="icon-slide" href="#" title="Mở rộng / thu gọn"></a>
                </div>
              </div>
            </div>
          </section>
        </div>
        <div class="right-content visible-pc">
          <div v-pre class="form-real-estate">
            <h3 class="font-tiempos">Liên hệ tư vấn</h3>
            <div class="cover__isa">
              <img class="lazy fade" data-src="{% static 'images/isa-team-v2.png' %}" alt="tgnp">
            </div>
            <h5 class="advisory__title">Chuyên viên đã sẵn sàng hỗ trợ!</h5>
            <p class="advisory__sub-title">Tư vấn hoàn toàn miễn phí</p>
            <p class="text-small-center">
              <span>Mã nhà đất:  <strong> {{ listing.code }} </strong></span>
            </p>
            <a data-phone-hidden="category: ContactProperty, event: ClickHiddenHotline" style="opacity: 0.6"
               href="tel:{{ listing.realtor.user.phone }}" class="btn-primary btn-large btn-red btn-phone phone-hidden"><i
              class="zmdi zmdi-phone"></i><span class="text">Gọi chuyên viên ngay</span></a>
            <div class="divive">hoặc</div>
            <ul class="group-cta">
              <li>
                <a href="javascript:void(0)" style="opacity: 0.3" class="btn-property btn-hubspot-chat">Chat với TGNP</a>
              </li>
              <li>
                <a href="javascript:void(0)" style="opacity: 0.3" class="btn-property btn-contact-me">Liên hệ lại tôi</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>
    <div class="cta-bottom-wrapper listing__cta--bottom">
      <p class="listing__cta--bottom-id">{% trans "Mã nhà đất: " %}<strong>{{ listing.code }}</strong>
      </p>
      <div class="cta-bottom-inner">
        <div class="listing__chat">
          <a class="cta-form request-info btn-hubspot-chat" style="opacity: 0.3" href="javascript:void(0)"><i
            class="zmdi zmdi-comment-text-alt"></i>Chat</a>
        </div>
        <div class="phone">
          <a class="cta-hotline" href="tel:{{ listing.realtor.user.phone }}">
            <span><i class="zmdi zmdi-phone"></i>{{ listing.realtor.user.phone }}</span>
          </a>
        </div>
      </div>
    </div>

    <section id="sticky" class="bg-white mgb-0">
      <section class="width1140">
        <div class="right-content">
          <div id="agent-fix" class="fixed-form"></div>
        </div>
      </section>
    </section>
    <div class="mdialog" id="sell-now-form" style="background: none">
      <div class="popup-overlay">
        <div class="title title-res">
          <span> <a class="back-icon cnb-close" href="javascript:void(0)"></a> </span>
          <span class="house-type">Bán, cho thuê nhà với TGNP</span>
        </div>
        <div class="popup-contact">
          <div class="bg-e1e2e6 header">
            Bán, cho thuê nhà với TGNP
          </div>
          <div class="actionIcon cnb-close"></div>
          <div class="form-contact contact-form">
            <div class="contact" id="sell-now-form-body"></div>
          </div>
        </div>
      </div>
    </div>

    <section class="background-gray">
      <section class="width1140 main-content">
        <div class="heading-02 mgt-10">Nhà đất lân cận</div>
        <section class="compare-house">
          {% for listing in listings_neighborhood %}
            {% include "listings/_nearByListing.html" %}
          {% endfor %}
        </section>
      </section>
    </section>
    <section class="bg-gray-e6 pdt-0">
      <section class="width1140">
        <div class="heading-02">Bạn đang cần bán hay cho thuê nhà?</div>
        <div class="ads3d-box pdt-15">
          <div class="ads3d-box-left">
            <div class="promo-3d-vid cover">
              <span data-origin="8IP1dKqq298" class="popup-yt-video">
              <picture>
              <source
                srcset="{% static 'images/service-3dview.png' %}, {% static 'images/service-3dview.png' %} 2x"
                media="(max-width: 374px)">
              <source
                srcset="{% static 'images/service-3dview.png' %}, {% static 'images/service-3dview.png' %} 2x"
                media="(min-width: 375px)">
              <img alt="TGNP 3D View" data-src="{% static 'images/service-3dview.png' %}"
                   srcset="{% static 'images/service-3dview.png' %}, {% static 'images/service-3dview.png' %} 2x"
                   title="TGNP 3D View">
              </picture>
              </span>
            </div>
            <div class="about-3d">
              <h3>Tuyệt vời khi trình diễn với 3d nhập vai</h3>
              <p>Công nghệ 3d nhập vai của Thế giới Nhà Phố mang lại trải nghiệm có độ tin cậy tuyệt đối
                với khách hàng khi xem trực tuyến ở tất cả mọi nơi. Kết hợp đội ngũ nhân viên được đào tạo chuyên
                nghiệp đã giúp cho tốc độ bán nhanh hơn gấp đôi so với thị trường.</p>
            </div>
          </div>
          <div class="ads3d-box-right">
            <div class="clear">
              <div class="cover">
                <img class="lazy" style="object-fit: cover; object-position: center center"
                     data-src="{% static 'img/logo-ko-chu.svg' %}"
                     alt="thegioinhaphovietnam.com.vn" title="thegioinhaphovietnam.com.vn">
              </div>
              <div class="infoagent">
                <h4>thegioinhaphovietnam.com.vn</h4>
                <p>Hỗ trợ 24/7</p>
                <p>
                  <a class="hotline" href="tel:{{ listing.realtor.user.phone }}" title="hotline">
                    {{ listing.realtor.user.phone }}
                  </a>
                </p>
              </div>
            </div>
            <a class="like-button" href="#sell-now-form" title="Liên hệ">Liên hệ</a>
            <input type="hidden" name="contact-agent" value="thegioinhaphovietnam@gmail.com">
            <input type="hidden" name="contact-agent-msg"
                   value="Tôi có nhu cầu muốn bán nhà thông qua TGNP. Liên lạc với tôi ngay.">
          </div>
        </div>
      </section>
    </section>

    <section class="background-gray">
      <div class="width1140">
        <div class="heading-02 pd-tb-30 mgt-10">Nhà đất tương tự</div>
        <div id="similar-property" class="flexslider main-content">
          <div class="slider-buttons">
            <a href="#" title="next"><span class="but-nextdetail-news flex-next"></span> </a>
            <a href="#" title="prev"><span class="but-predetail-news flex-prev flex-disabled" tabindex="-1"></span> </a>
          </div>
          <ul class="exclusive slides">
            {% for listing in listings_same %}
              {% include "listings/_neighbourListing.html" %}
            {% endfor %}
          </ul>
        </div>
      </div>
    </section>

    <div id="property-contactbox-v2-app"></div>
    <div id="detailPopupContact">{% include "listings/_detailPopupContactTemplate.html" %}</div>
    {% include "partials/_detailFeedbackForm.html" %}
  </div>

{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script async src="{% load_static 'js/listing.js' %}"></script>
  <script>
      window['isListing'] = true;
      window['favorite_api'] = 'api/favorite';
      window['hotline'] = '{{ listing.realtor.user.phone }}'
  </script>
  <script async type="text/javascript" src="{% load_static 'js/property-contact-box.js' %}"></script>
  <script>
      var addthis_share = {
          url: window.location.href
      }
  </script>
  <script defer src="{% load_static 'js/favorite.min.js' %}"></script>
  <script defer src="{% load_static 'js/home-recent-view.min.js' %}"></script>

  <script type="deferjs">
  function setupViewMore(heightLimit, $itemsWrapper, $items, $viewMoreWrapper, $viewMoreLink){
    var isCollapse = false
    var itemHeight = $items.height()
    $itemsWrapper.css("box-sizing", "content-box")
    $viewMoreLink.click(function () {
      if(!isCollapse){
        showMore()
      }else{
        hide()
      }
    })

    function showMore(){
      isCollapse = true
      $viewMoreLink.html('Thu gọn<i class="zmdi zmdi-chevron-up zmdi-hc-fw"></i>')
      //$itemsWrapper.css('height', 'auto')
      $itemsWrapper.animate({height: itemHeight + "px"}, 500)
    }

    function hide(){
      isCollapse = false
      $viewMoreLink.html('Xem thêm<i class="zmdi zmdi-chevron-down zmdi-hc-fw"></i>')
      //$itemsWrapper.css('height', heightLimit + 'px')
      $itemsWrapper.animate({height: heightLimit + "px"}, 500)
    }

    if(itemHeight > heightLimit){
      $viewMoreWrapper.show()
    }else{
      $itemsWrapper.css('height', itemHeight + "px")
    }
  }

  var publicFacEle = {
    wrapper: $("#public-facilities .items"),
    items: $("#public-facilities .items ul"),
    viewMore: $("#public-facilities .view-more-wrapper"),
    viewMoreLink: $("#public-facilities .view-more-wrapper a")
  }
  $(document).ready(function(){
    setupViewMore(114, publicFacEle.wrapper, publicFacEle.items, publicFacEle.viewMore, publicFacEle.viewMoreLink)
  })



  </script>

  <script type="deferjs">
  (function () {
    var formQueue = [];

    function queuedForm(opt) {

        formQueue.push(opt);
      }
    }

    var awaitTimeout = 0;
    var awaitHSForm = function () {
      awaitHSForm.called = true;
      if (formQueue && hbspt && hbspt.forms && hbspt.forms.deps) {
        formQueue.forEach(function (_opt) {
          hbspt.forms.create(_opt);
        });
        clearTimeout(awaitTimeout);
        delete formQueue;
      } else {
        awaitTimeout = setTimeout(awaitHSForm, 500);
      }
    };
    window['hbspt'] = {
      forms: {
        create: function (opt) {
          if (!awaitHSForm.called) {
            awaitHSForm();
          }
          queuedForm(opt);
        }
      }
    };
  })();



  </script>
  {% comment %}  <script charset="utf-8" type="deferjs" src="https://js.hsforms.net/forms/v2.js"></script>{% endcomment %}
  <script type="deferjs">
  function createHSForm(opt) {
    function getClientId() {
      try {
        return ga.getAll()[0].get('clientId');
      } catch (e) {
        return ""
      }
    }

    var optFS = opt['onFormSubmit'];
    var defaultOpt = Object.create(opt);
    defaultOpt.onFormSubmit = function () {
      var $gaClientId = $('[name=ga_client_id]');
      if ($gaClientId[0]) {
        $gaClientId.val(getClientId());
      }
      if (typeof optFS === 'function') {
        optFS.apply(this, arguments)
      }
    };
    return hbspt.forms.create(defaultOpt);
  }
  var dialogManager = (function DialogService() {
    var fact = this;
    fact.bodyClassSpecs = "mdialog-body";
    fact.bodyLoadingClass = "mdialog-loading";
    fact.cachedBodyStyle = null;
    fact.default = {
      zindex: 99999,
      width: 300,
      minHeight: 100,
      background: "rgba(0,0,0,.5)",
      opacity: 0.5
    };
    fact.key = {
      cachedStyle: "cached-style"
    };
    var v0 = 0.05;
    var a = 0.0002;
    fact.show = function (selectorId, options, hideFn, showFn) {
      options = $.extend(true, {
        outSideClick: true
      }, options || {});
      options.maxWidth = "100%";
      var dialog, oldStyle = document.body.getAttribute("style");
      document.body.setAttribute(fact.key.cachedStyle, oldStyle);
      if (selectorId && typeof selectorId === 'string') {
        dialog = $(document.getElementById(selectorId));
      } else {
        dialog = selectorId;
      }
      dialog.css("opacity", 0);
      dialog.css("overflow-y", "auto");
      dialog.css("overflow-x", "hidden");
      dialog.addClass("opened");
      var bodyClass = (options ? options.body : "") || ".body";
      dialog.find(bodyClass).css(options);
      dialog.find(bodyClass).addClass(fact.bodyClassSpecs)
      dialog[0] ? dialog[0]["$dialogCallback"] = hideFn : null;
      dialog[0] ? dialog[0]["$dialogInitTime"] = +new Date() : null;
      if (options && options.close) {
        dialog.find(bodyClass + " " + options.close).off().click(function (e) {
          e.preventDefault();
          fact.hide(selectorId, hideFn);
        });
      }
      if (options && options.outSideClick) {
        dialog.off().click(function () {
          fact.hide(selectorId, hideFn);
        });
      }
      dialog.find(bodyClass).click(function (e) {
        e.stopPropagation();
      });
      //.preventParentScroll();
      fact.animation(dialog, 0, 0, 1, function () {
        showFn ? showFn() : null;
      });
      fact.loadingEnd(dialog);
      return dialog;
    };
    fact.animation = function (dialog, opa, t, delta, callback) {
      dialog.css("opacity", opa);
      if ((delta > 0 && opa > 1) || (delta < 0 && opa < 0)) {
        if (callback) {
          callback();
        }
        return;
      }
      setTimeout(function () {
        opa += delta * (v0 * t + 1 / 2 * a * t * t);
        fact.animation(dialog, opa, t + 1, delta, callback);
      }, 10);
    };
    fact.hide = function (selectorId, fn) {
      var dialog;
      if (!selectorId) {
        dialog = $(".mdialog.opened");
      } else if (typeof selectorId === 'string') {
        dialog = $(document.getElementById(selectorId));
      } else {
        dialog = selectorId;
      }
      fact.animation(dialog, 1, 0, -1, function () {
        dialog.removeClass("opened");
        fn ? fn(dialog) : null;
      });
    };
    fact.loadingStart = function (selectorId) {
      var dialog;
      if (!selectorId) {
        dialog = $(".mdialog.opened");
      } else if (typeof selectorId === 'string') {
        dialog = $(document.getElementById(selectorId));
      } else {
        dialog = selectorId;
      }
      dialog.find("." + fact.bodyClassSpecs).addClass(fact.bodyLoadingClass);
    };
    fact.loadingEnd = function (selectorId) {
      var dialog;
      if (!selectorId) {
        dialog = $(".mdialog.opened");
      } else if (typeof selectorId === 'string') {
        dialog = $(document.getElementById(selectorId));
      } else {
        dialog = selectorId;
      }
      dialog.find("." + fact.bodyClassSpecs + "." + fact.bodyLoadingClass).removeClass(fact.bodyLoadingClass);
    };
    $(window).keydown(function (e) {
      var openedDialog = $(".mdialog.opened");
      if (openedDialog.length && e.keyCode == 27) {
        var arr = [];
        arr.length = openedDialog.length;
        for (var i = 0; i < openedDialog.length; i++) {
          for (var j = i; j < openedDialog.length; j++) {
            if (openedDialog[i]["$dialogInitTime"] > openedDialog[j]["$dialogInitTime"]) {
              arr[j] = openedDialog[i];
              arr[i] = openedDialog[j];
            } else {
              arr[i] = openedDialog[i];
              arr[j] = openedDialog[j];
            }
          }
        }
        var lastedOpen = arr[arr.length - 1];
        if (lastedOpen) {
          fact.hide($(lastedOpen), lastedOpen ? lastedOpen["$dialogCallback"] : null);
        }
      }
    });
    fact.initStyles = function () {
      var css = "";
      var style = document.createElement("STYLE");
      var head = document.head || document.getElementsByTagName("head")[0];
      style.type = "text/css";
      if (style.styleSheet) {
        style.styleSheet.cssText = css;
      } else {
        style.appendChild(document.createTextNode(this.getCss()));
      }
      head.appendChild(style);
    };
    fact.getCss = function () {
      var options = fact.default;
      var css = "";
      var dialog = {};
      dialog["display"] = "none";
      dialog["position"] = "fixed";
      dialog["top"] = "0";
      dialog["height"] = "100%";
      dialog["left"] = "0";
      dialog["width"] = "100%";
      dialog["z-index"] = options.zindex;
      dialog["background"] = options.background;
      css += fact.assignStyle(".mdialog", dialog);
      css += ".mdialog.opened{display: block;}";
      var body = {};
      body["width"] = options.width + "px";
      body["min-height"] = options.minHeight + "px";
      body["background"] = "#fff";
      body["margin"] = "60px auto 140px auto";
      css += fact.assignStyle(".mdialog .body", body);
      var bodySpecs = {};
      bodySpecs["position"] = "relative"
      css += fact.assignStyle("." + fact.bodyLoadingClass, bodySpecs);
      var loadingFrame = {};
      loadingFrame["content"] = "' '";
      loadingFrame["top"] = 0;
      loadingFrame["left"] = 0;
      loadingFrame["width"] = "100%";
      loadingFrame["height"] = "100%";
      loadingFrame["position"] = "absolute";
      loadingFrame["background"] = "#fff";
      loadingFrame["opacity"] = 0.4;
      loadingFrame["z-index"] = 1;
      css += fact.assignStyle("." + fact.bodyLoadingClass + ":before", loadingFrame);
      var loading = {};
      loading["content"] = "' '";
      loading["border"] = "2px solid #303339";
      loading["border-top"] = "2px solid #fff;";
      loading["border-radius"] = "50%";
      loading["width"] = "30px";
      loading["height"] = "30px";
      loading["position"] = "absolute";
      loading["top"] = "calc(50% - 15px)";
      loading["left"] = "calc(50% - 15px)";
      loading["-webkit-animation"] = "spin 2s linear infinite";
      loading["animation"] = "spin 2s linear infinite";
      loading["z-index"] = 1;
      css += fact.assignStyle("." + fact.bodyLoadingClass + ":after", loading);
      css += "@-webkit-keyframes spin { 0% { -webkit-transform: rotate(0deg); } 100% { -webkit-transform: rotate(360deg); } } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }";
      return css;
    };
    fact.assignStyle = function (name, cssobj) {
      var res = name + "{";
      for (var key in cssobj) {
        var val = cssobj[key];
        res += key + ":" + val + ";";
      }
      res += "}";
      return res;
    };
    fact.initStyles();
    return fact;
  })();

  if (!window['showDialog']) {
    window['showDialog'] = function (id, closeClass, bodyClass) {
      dialogManager.show("contact-now", {
        close: closeClass,
        body: bodyClass
      }, function hideFn() {
      }, function showFn(dialog) {
        $('#' + id).find("input").first().focus();
        $(bodyClass).css("max-width", "").css("width", "100%")
            .find(".popup-contact").scrollTop(0);
      });
    }
  }



  </script>
  <script type="deferjs">
        createHSForm({
            css: '',
            target: '#sell-now-form-body',
            portalId: '2775524',
            formId: '9cc2fa2e-59d1-410a-a910-217a24437963',
            onFormReady: function($form){
                $form.on("submit", function(e){
                    goog_report_conversion ? goog_report_conversion() : null;
                });
            }
        });


  </script>

  <script defer src="{% load_static 'js/header-v2.min.js' %}"></script>
  {% if listing.videos %}
    <link href="//vjs.zencdn.net/7.10.2/video-js.min.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="//vjs.zencdn.net/7.10.2/video.min.js"></script>
    <script type="text/javascript" src="{% load_static 'js/youtube_video.min.js' %}"></script>
  {% endif %}"

{% endblock %}
