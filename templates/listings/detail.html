{% extends 'base.html' %}

{% load static humanize i18n get_cadastral %}

{% block head %}
  {{ block.super }}

  <link rel="canonical" href="{% url 'detail' %}/{{ listing.id }}"/>

{% endblock %}

{% block head_script %}

  <link rel="stylesheet" href="{% static 'css/listing-detail-page90ca.css' %}"/>

  <style>
      .detail-content-news img:before, .thumb-duan img:before, .cover img:not([src]):before {
          background-image: none !important;
      }

      .info-sketch {
          height: auto;
          min-height: 190px;
      }

      @media screen and (max-width: 480px) {
          .info-sketch {
              padding-top: 20px;
          }

          .floorplan-property .content {
              padding-bottom: 0;
          }
      }

      .gallery-property div img {
          object-fit: cover;
          object-position: center;
      }
  </style>

  <style>
      .gmap-render.full-screen {
          max-width: 100% !important;
      }

      ._map-bg {
          background: url({% static 'images/map-detail.png' %}) center / cover no-repeat;
          cursor: pointer;
          width: 100%;
          height: 100%;
          z-index: 2;
      }

      /*Mặc định sẽ ẩn map render*/
      .map-detail .map-wrapper {
          display: none
      }

      /* Khi fullscreen thì sẽ hiện map render lên */
      .map-detail.full-screen .map-wrapper {
          display: block;
          position: relative;
          width: 100%;
          height: 100%;
      }

      /* Khi fullscreen thì ẩn cái ảnh map đi */
      .map-detail.full-screen .img-map {
          display: none
      }

      /* Mặc định sẽ ẩn nút fullscreen đi */
      .map-wrapper .full-screen-act {
          display: none
      }

      /* Và sẽ hiện fullscreen khi đang ở chế độ fullscreen */
      .map-detail.full-screen .full-screen-act {
          display: block
      }
  </style>

  <style>

  </style>
{% endblock %}

{% block content %}
  <!-- Search menu -->
  {% include 'partials/_menuSearch.html' %}
  {% for message in messages %}
    <div class="alert {{ message.tags }} alert-dismissible " role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      <p class="alert-message blink"> {{ message }}</p>
      {#      {{ message }}#}
    </div>
  {% endfor %}
  <input id="markerwithlabel" type="hidden" value="{% static 'js/markerwithlabel-0.0.1.min.js' %}">

  <div id="wrap">
    <div class="banner-app-tgnp" id="tgnp-banner-prompt" style="display: none">
      <div class="banner-app-content">
        <button onclick="AppPrompt.closePrompt()" class="close-banner-app">
          <i class="zmdi zmdi-close"></i>
        </button>
        <a href="javascript:void(0)" class="cover">
          <img src="{% static 'img/logo.svg' %}" alt="Thế giới Nhà Phố">
        </a>
        <div class="banner-app-info">
          <a href="javascript:void(0)">TGNP</a>
          <p>Mua bán nhà dễ dàng</p>
          <div class="rating-star">
            <i class="zmdi zmdi-star evaluated"></i>
            <i class="zmdi zmdi-star evaluated"></i>
            <i class="zmdi zmdi-star evaluated"></i>
            <i class="zmdi zmdi-star evaluated"></i>
            <i class="zmdi zmdi-star-half evaluated"></i>
          </div>
        </div>
      </div>
      <a href="javascript:void(0)" class="btn-install">Mở</a>
    </div>

    <input name="recent-view-property-id" type="hidden" value="{{ listing.id }}">
    <input name="recent-view-service-type" type="hidden" value="{{ listing.transaction_type }}">
    <div class="background-detail mpreviews">
      <form name="info" class="hidden">
        <input name="id" type="hidden" value="{{ listing.id }}">
        <input name="source" type="hidden" value="tgnp">
        <input name="rvid" type="hidden" value="{{ listing.code }}">
        <input name="title" type="hidden" value="{{ listing.title }}">
        <input name="price" type="hidden" value="{{ listing.price }}">
        <input name="thumbnail" type="hidden"
               value="{% with listing.main_photo as photo %}{{ photo.url }}{% endwith %}">
        <input name="price-format" type="hidden" value="{{ listing.price }} tỷ">
        <input name="num-bed-room" type="hidden" value="{{ listing.bedrooms }}">
        <input name="num-bath-room" type="hidden" value="{{ listing.bathrooms }}">
        <input name="sale-status" type="hidden" value="{{ listing.is_published }}">
        <input name="agent-avatar" type="hidden" value="{% static 'img/logo.svg' %}">
        <input name="agent-id" type="hidden" value="id-{{ listing.id }}">
        <input name="agent-name" type="hidden" value="thegioinhaphovietnam.com.vn">
        <input name="agent-encoded" type="hidden" value="">
        <input name="agent-job-title" type="hidden" value="Hỗ trợ 24/7">
        <input name="agent-phone" type="hidden" value="0916 286 256">
        <input name="contact" type="hidden" value="0916 286 256">
        <input name="area" type="hidden" value="{{ listing.area }}">
        <input name="service-type" type="hidden" value="">
        <input name="property-type" type="hidden" value="">
        <input name="direction" type="hidden" value="{{ listing.direction }}">
        <input name="street" type="hidden" value="{{ listing.street }}">
        <input name="ward" type="hidden" value="{{ listing.ward }}">
        <input name="district" type="hidden" value="{{ listing.district }}">
        <input name="city" type="hidden" value="{{ listing.state }}">
        <input name="neighborhood" type="hidden" value="">
        <input name="lat" type="hidden" value="">
        <input name="lon" type="hidden" value="">
        {% for video in listing.videos %}
            <input name="youtube" type="hidden" value="{{ video.video }}">
        {% endfor %}
        <input name="favorited_type" type="hidden" value="sale_property">
        <input name="streetviewLat" type="hidden" value="">
        <input name="streetviewLon" type="hidden" value="">
      </form>
      <div class="mphotos height-100-percent">
        <div id="slider" class="flexslider">
          <div class="group-share">
            <a href="#" style="opacity: 0.3" data-id="{{ listing.id }}" data-action="favorite"
               data-alias="{{ listing.title }}"
               data-type="sale_property" class="" data-favorited="false">
              <i class="zmdi zmdi-favorite-outline"></i>
              <span>Yêu thích</span>
            </a>
          </div>
          <div class="slider-buttons">
            <a href="#"><span class="but-nextdetail flex-next"></span></a>
            <a href="#"><span class="but-predetail flex-prev flex-disabled" tabindex="-1"></span></a>
          </div>
          <div class="flex-viewport">
            <ul class="slides">
              {% for photo in listing.photos %}
                <li>
                  <a href="#" pos="0" class="cover">
                    <img class="lazy"
                         data-src="{{ photo.url }}"
                         alt="{{ listing.title }}"
                         title="{{ listing.title }}"
                         draggable="false">
                  </a>
                </li>
              {% empty %}
                <li>
                  <img class="lazy"
                       data-src="{% static 'img/default.png' %}"
                       alt="{{ listing.title }}"
                       title="{{ listing.title }}"
                       draggable="false">
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      <div class="mvideo height-100-percent">
        <video
          id="listing-video"
          class="video-js vjs-default-skin"
          controls
          preload="auto"
          data-setup="{'techOrder': ['youtube'],}"
{#          data-setup='{ "techOrder": ["youtube"], "sources": [{ "type": "video/youtube", "src": "{{ listing.videos.0.video }}"}] }'#}
        >
          {% for video in listing.videos %}
            <source src="{{ video.video }}" type="video/youtube">
          {% endfor %}
        </video>
        <iframe id="preview-video" frameborder="0" allowfullscreen>

        </iframe>
      </div>
      <div class="mview3d preview3d hidden height-100-percent">
        <a href="#" class="full-screen-act" title="Fullscreen"></a>
        <iframe frameborder="0" allow-fullscreen=""></iframe>
      </div>
      <div class="mstreetview hidden height-100-percent">
        <div id="preview-streetview"></div>
      </div>
      <div class="fullscreen-slide preview">
        <a href="#" class="full-screen-act close" title="Fullscreen"></a>
        <div id="slider8" class="flexslider fullscreen">
          <div class="slider-buttons">
            <a href="#" title="next"><span class="but-nextdetail flex-next"></span> </a>
            <a href="#" title="prev"><span class="but-predetail flex-prev"></span> </a>
          </div>
          <ul class="slides">
            {% for photo in listing.photos %}
              <li>
                <a href="#" class="cover"
                   title="{{ listing.title }}">
                  <img src="{{ photo.url }}"
                       pos="0"
                       alt="{{ listing.title }}"
                       title="{{ listing.title }}">
                </a>
              </li>
            {% empty %}
              <li>
                <img src="{% static 'img/default.png' %}"
                     pos="0"
                     alt="{{ listing.title }}"
                     title="{{ listing.title }}">
              </li>
            {% endfor %}

          </ul>
        </div>
        <div id="carousel1" class="flexslider img-list-slide">
          <ul class="slides slideimg">
            {% for photo in listing.photos %}
              <li>
                <a class="img cover" href="#" pos="0"
                   title="{{ listing.title }}">
                  <img class="lazy image-normalized"
                       data-src="{{ photo.url }}"
                       alt="{{ listing.title }}"
                       title="{{ listing.title }}">
                </a>
              </li>
            {% empty %}
              <li>
                <img class="lazy image-normalized" src="{% static 'img/default.png' %}"
                     data-src="{% static 'img/default.png' %}"
                     alt="{{ listing.title }}"
                     title="{{ listing.title }}">
              </li>
            {% endfor %}
          </ul>
          <div class="slider-buttons2">
            <a class="font-icon icon-presmall flex-prev" href="#" title="prev"></a>
            <a class="font-icon icon-nextsmall flex-next" href="#" title="next"></a>
          </div>
        </div>
      </div>

    </div>
    <div class="changeimg-box">
      <div class="fix-widthcell">
        <div id="carousel" class="flexslider">
          <div class="slider-buttons2">
            <a class="font-icon icon-presmall flex-prev flex-disabled" href="#" tabindex="-1"
               title="prev"></a>
            <a class="font-icon icon-nextsmall flex-next" href="#" title="next"></a>
          </div>
          <div class="flex-viewport">
            <ul class="slides slideimg">
              {% for photo in listing.photos %}
                <li class="flex-active-slide">
                  <a class="img cover" href="javascript:void(0)"
                     title="{{ listing.title }}">
                    <img class="lazy image-normalized"
                         data-src="{{ photo.url }}"
                         title="{{ listing.title }}"
                         alt="{{ listing.title }}"
                         draggable="false">
                  </a>
                </li>
              {% empty %}
                <li class="flex-active-slide">
                  <img class="lazy image-normalized"
                       data-src="{% static 'img/default.png' %}"
                       title="{{ listing.title }}"
                       alt="{{ listing.title }}"
                       draggable="false">
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
        <ul class="naviicon">
          <li class="active ">
            <a href="#photos" title="Photo" no-prevent>
              <span class="font-icon photo"></span> Photo
            </a>
          </li>
          <li class="{% if not listing.videos %}disable{% endif %}">
            <a href="#video" title="Video" no-prevent>
              <span class="font-icon video"></span> Video
            </a>
          </li>
          {#                    <li class="">#}
          {#                        <a href="#view3d" title="3D view" no-prevent>#}
          {#                            <span class="font-icon view3d"></span> 3D view#}
          {#                        </a>#}
          {#                    </li>#}
          {#                    <li class="">#}
          {#                        <a href="#streetview" title="Street view" no-prevent>#}
          {#                            <span class="font-icon streetview"></span> Street view#}
          {#                        </a>#}
          {#                    </li>#}
        </div>
      </div>
    </div>
    <section class="page-listing-detail">
      <div class="width1140">
        <div class="left-content">
          <div class="content-detail-house">
            <header class="detail-house">
              <div class="address">
                {% if listing.urban_area %}
                  <h2><a href="{% url 'listing_search' %}?urban_area={{ listing.urban_area }}"
                         title="Khu đô thị/ khu dân cư">{{ listing.urban_area }}</a></h2>
                {% endif %}
                <h2><a href="{% url 'listing_search' %}?street={{ listing.street }}"
                       title="Đường">{{ listing.street }}</a></h2>
                {% if listing.ward %}
                  <h2><a href="{% url 'listing_search' %}?ward={{ listing.ward }}"
                         title="Phường/Xã">{{ listing.ward }}</a></h2>
                {% endif %}
                <h2><a href="{% url 'listing_search' %}?district={{ listing.district }}"
                       title="Quận/Huyện">{% get_district listing.district %}</a></h2>
                <h2><a href="{% url 'listing_search' %}?state={{ listing.state }}"
                       title="Tỉnh/Thành phố">{% get_state listing.state %}</a></h2>

              </div>
              <h2>{{ listing.title }}</h2>
              <div class="detail-row">
                <ul class="detailroom">
                  <li title="Diện tích"><span
                    class="zmdi zmdi-photo-size-select-small"></span> {{ listing.area }} m2</li>
                  <li title="Giá"><strong>$</strong> {{ listing.price }} tỷ</li>
                  {% if listing.sale_price  and listing.sale_price < listing.price %}
                    <li title="Bán nhanh"><strong>Bán nhanh {{ listing.sale_price }} tỷ </strong></li> {% endif %}
                </ul>
                <div class="listing-id">
                  <span>Mã nhà đất: </span>
                  <span style="padding-left: 0px">{{ listing.code }}</span>
                </div>
              </div>
            </header>
          </div>
          <div class="heading-02">Mô tả ngắn gọn</div>
          <div class="content collapsed pdb-0" data-height="150">
            <p class="summary">{{ listing.description }}</p>
          </div>
          <p class="more">
            <a href="#" title="Xem thêm / thu gọn" class="collapse" is-more="true" more="Xem thêm"
               less="Thu gọn">Xem thêm</a>
          </p>
          <div class="heading-02">Thông tin cơ bản</div>
          <div class="content">
            <ul class="detail-more">
              <li>
                <p class="left">Loại hình</p>
                <p class="right"><a href="{% url 'listing_search' %}?house_type={{ listing.house_type }}"
                                    target="_blank">
                  {% if listing.house_type == 'town_house' %}{% translate 'Nhà Phố' %}
                  {% elif listing.registration_type == 'street_house' %} {% translate 'Nhà mặt phố' %}
                  {% elif listing.registration_type == 'shop_house' %} {% translate 'Cửa hàng' %}
                  {% elif listing.registration_type == 'building' %} {% translate 'Toà nhà' %}
                  {% elif listing.registration_type == 'apartment' %} {% translate 'Căn hộ CC' %}
                  {% elif listing.registration_type == 'villa' %} {% translate 'Biệt thự' %}
                  {% elif listing.registration_type == 'office' %} {% translate 'Văn phòng' %}
                  {% else %} {% translate 'Đất' %}  {% endif %}
                </a></p>
              </li>
              <li>
                <p class="left">Số tầng</p>
                <p class="right">{% if listing.floors %}{{ listing.floors }}{% else %} 0 {% endif %}</p>
              </li>
              <li>
                <p class="left">Số phòng ngủ</p>
                <p class="right">{{ listing.bedrooms }}</p>
              </li>
              <li>
                <p class="left">Số phòng tắm</p>
                <p class="right">
                  {% if listing.bathrooms %}{{ listing.bathrooms }}{% else %} 0 {% endif %}</p>
              </li>
              <li>
                <p class="left">Diện tích</p>
                <p class="right">{{ listing.area }} {{ listing.area_unit }}</p>
              </li>
              <li>
                <p class="left">Diện tích khuân viên</p>
                <p class="right">{{ listing.lot_size }}</p>
              </li>
              <li>
                <p class="left">Loại chứng nhận</p>
                <p class="right"><a
                  href="{% url 'listing_search' %}?registration_type={{ listing.registration_type }}"
                  target="_blank">
                  {% if listing.registration_type == 'red_book' %}{% translate 'Sổ đỏ' %}
                  {% elif listing.registration_type == 'pink_book' %} {% translate 'Sổ hồng' %}
                  {% else %} {% translate 'Chưa làm sổ' %}  {% endif %}</a></p>
              </li>
              <li>
                <p class="left">Giá bán</p>
                <p class="right">{{ listing.price }} tỷ</p>
              </li>
              {% if listing.sale_price %}
                <li>
                  <p class="left">Bán nhanh</p>
                  <p class="right">{{ listing.sale_price }} tỷ</p>
                </li>
              {% endif %}
            </ul>
          </div>
          <div class="form-real-estate visible-sm">
            <div class="heading-02">Liên hệ tư vấn</div>
            <div class="form-real-estate__row">
              <div class="col-left">
                <div class="cover__isa">
                  <img src="{% static 'images/isa-team-v2.png' %}" alt="tgnp">
                </div>
                <h5 class="advisory__title">Chuyên viên đã sẵn sàng hỗ trợ!</h5>
              </div>
              <a style="opacity: 0.3" href="javascript:void(0)"
                 class="btn-contact-me btn-primary btn-black btn-form-real-estate">Yêu cầu liên hệ lại</a>
            </div>
          </div>
          <div id="booking-form-sm-wrapper"></div>

          <div class="heading-02">Ưu điểm ngôi nhà</div>
          <div class="content">
            <div class="list-advantage clear">
              <div class="advantage-name">
                <p>Tag</p>
              </div>
              <div class="advandate-content">
                <div class="tag-news pd-0">
                  <span>{{ listing.house_type }} {{ listing.district }}</span>
                  <span>{{ listing.house_type }} {{ listing.floors }} tầng</span>
                  <span>{{ listing.house_type }} {{ listing.bedrooms }} phòng ngủ</span>
                </div>
              </div>
            </div>
            <div class="list-advantage clear">
              <div class="advantage-name">
                <p>Đặc điểm nổi bật</p>
              </div>
              <div class="advandate-content">{{ listing.salient_features }}</div>
            </div>
              <div class="list-advantage clear">
              <div class="advantage-name">
                <p>Ưu điểm vị trí</p>
              </div>
              <div class="advandate-content">{{ listing.location_advantage }}</div>
            </div>
            <div class="list-advantage clear">
              <div class="advantage-name">
                <p>Nội thất kèm theo</p>
              </div>
              <div class="advandate-content">{{ listing.furniture_included }}</div>
            </div>
            <div class="list-advantage clear">
              <div class="advantage-name">
                <p>Tiện ích sinh hoạt</p>
              </div>
              <div class="advandate-content">{{ listing.living_facilities }}</div>
            </div>
            <div class="list-advantage clear">
              <div class="advantage-name">
                <p>Cộng đồng dân cư</p>
              </div>
              <div class="advandate-content">{{ listing.residential_community }}</div>
            </div>
            <div class="list-advantage clear">
              <div class="advantage-name">
                <p>An sinh khu vực</p>
              </div>
              <div class="advandate-content">{{ listing.regional_welfare }}
              </div>
            </div>
            <div class="list-advantage clear">
               <div class="advantage-name">
                <p>Tình trạng BĐS</p>
              </div>
              <div class="advandate-content">{% if listing.status == 'selling' %} {% trans 'Đang bán' %}
                {% elif listing.status == 'sold' %} {% trans 'Đã bán' %}
                {% elif listing.status == 'stop_selling' %} {% trans 'Dừng bán' %}
                {% else %} {% trans 'Mới' %}
                {% endif %}
              </div>
            </div>
          </div>

          {% comment %}<div class="heading-02">Tiện ích</div>
          <div id="details-amenities" class="content collapsed">
            <ul class="detail-more">
              <li><p class="left">Ban công</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Phòng cho giúp việc</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Sân vườn</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Phòng giải trí</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Chỗ đậu xe hơi</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Hồ bơi riêng</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Quầy minibar</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Tầng hầm</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Góc làm việc</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Nhà kho</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Nuôi thú cưng</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Gym</p>
                <p class="right zmdi zmdi-close"></p>
              </li>


            </ul>
          </div>
          <p class="more">
            <a href="#" title="Xem thêm / thu gọn" class="collapse" is-more="true" more="Xem thêm"
               less="Thu gọn">Xem thêm</a>
          </p>

          <div class="heading-02">Thiết bị, dịch vụ</div>
          <div id="details-furniture" class="content collapsed">
            <ul class="detail-more">
              <li><p class="left">TV</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Máy hút mùi</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Cảm biến cháy</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Tủ lạnh</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Bếp ga, bếp từ</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Máy giặt</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Máy sấy</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Dàn phơi đồ thông minh</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Máy lạnh</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Máy nước nóng</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Khóa cửa thẻ từ</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Khóa cửa mật khẩu</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Khóa cửa vân tay</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Thiết bị âm thanh</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Smart Home</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Lò nướng</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Lò vi sóng</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Camera an ninh</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Internet</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
              <li><p class="left">Truyền hình cáp</p>
                <p class="right zmdi zmdi-close"></p>
              </li>
            </ul>
          </div>
          <p class="more">
            <a href="#" title="Xem thêm / thu gọn" class="collapse" is-more="true" more="Xem thêm"
               less="Thu gọn">Xem thêm</a>
          </p>{% endcomment %}

          <div class="heading-02">Hình ảnh</div>
          <div class="gallery-property collapsed" data-height="900">
            {% for photo in listing.photos %}
              <div class="cover">
                <a href="#" title="{{ listing.title }}">
                  <img class="lazy"
                       data-src="{{ photo.url }}"
                       alt="{{ listing.title }}"
                       title="{{ listing.title }}">
                  <span>Hình sản phẩm</span>
                </a>
              </div>
            {% endfor %}
            <div class="last-div"></div>
          </div>
          <p class="view-more-gray more">
            <a href="#" title="Xem thêm / thu gọn" style="text-underline: none" class="collapse pdt-0"
               is-more="true" more="Xem thêm" less="Thu gọn">Xem tất cả</a>
          </p>
          <div class="map-detail hidden"></div>
                  <div class="heading-02">Tiện ích khu vực</div>
                  <section class="mgt-15 map-detail gmap-render">
                    AIzaSyAWKbev18w2O63PfjhgpyU6DWvL6G4DCCc
                    <div class="_map-bg openBtn img-map"
                         style="background-image: url(https://maps.googleapis.com/maps/api/js?key=AIzaSyAWKbev18w2O63PfjhgpyU6DWvL6G4DCCc&libraries=drawing,places,geometry&language=vi&callback=callbackInitMap)">
                      <div class="tooltip-map">
                        <a>Nhấn vào để xem chi tiết</a>
                      </div>
                      <div class="map--address">
                        <div class="address-property">
                          <div class="left-70"><i class="zmdi zmdi-hc-2x zmdi-pin rever-red"></i>
                            <strong>{{ listing.title }}</strong>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="map-wrapper">
                      <a href="" class="full-screen-act" title="Fullscreen"></a>
                      <div id="render-map"></div>
                      <div class="cover-nearby">
                        <div class="nearby">
                          <div class="parent-content">
                            <form name="search-nearby">
                              <input type="text" id="nearby-search" class="" autocomplete="on"
                                     spellcheck="false" dir="auto"
                                     placeholder="Tìm kiếm địa điểm gần đây">
                            </form>
                            <div class="title">
                              <span>Bản đồ</span>
                              <div class="list-icon traffic-type">
                              </div>
                            </div>
                            <ul class="content directions pdb-0">
                            </ul>
                            <div class="title">Địa điểm gần nhất</div>
                            <ul class="type checkbox nearby-places">
                            </ul>
                          </div>
                        </div>
                        <div class="icon-left-nearby ">
                          <a class="location" href="#" title="Vị trí của BĐS"></a>
                          <a class="icon-slide" href="#" title="Mở rộng / thu gọn"></a>
                        </div>
                      </div>
                    </div>
                  </section>
        </div>
        <div class="right-content visible-pc">
          <div v-pre class="form-real-estate">
            <h3 class="font-tiempos">Liên hệ tư vấn</h3>
            <div class="cover__isa">
              <img src="{% static 'images/isa-team-v2.png' %}" alt="tgnp">
            </div>
            <h5 class="advisory__title">Chuyên viên đã sẵn sàng hỗ trợ!</h5>
            <p class="advisory__sub-title">Tư vấn hoàn toàn miễn phí</p>
            <p class="text-small-center">
              <span>Mã nhà đất:  <strong> {{ listing.code }} </strong></span>
            </p>
            <a data-phone-hidden="category: ContactProperty, event: ClickHiddenHotline" style="opacity: 0.6"
               href="tel:0971841941" class="btn-primary btn-large btn-red btn-phone phone-hidden"><i
              class="zmdi zmdi-phone"></i><span class="text">Gọi chuyên viên ngay</span></a>
            <div class="divive">hoặc</div>
            <ul class="group-cta">
              <li>
                <a href="javascript:void(0)" style="opacity: 0.3" class="btn-property btn-hubspot-chat">Chat
                  với TGNP</a>
              </li>
              <li>
                <a href="javascript:void(0)" style="opacity: 0.3" class="btn-property btn-contact-me">Liên
                  hệ lại tôi</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>
    <div class="cta-bottom-wrapper listing__cta--bottom">
      <p class="listing__cta--bottom-id">{% trans "Mã nhà đất: " %}<strong>{{ listing.code }}</strong>
      </p>
      <div class="cta-bottom-inner">
        <div class="listing__chat">
          <a class="cta-form request-info btn-hubspot-chat" style="opacity: 0.3" href="javascript:void(0)"><i
            class="zmdi zmdi-comment-text-alt"></i>Chat</a>
        </div>
        <div class="phone">
          <a class="cta-hotline" href="tel:0971841941">
            <i class="zmdi zmdi-phone"></i> 0971 841 941</a>
        </div>
      </div>
    </div>

    <section id="sticky" class="bg-white mgb-0">
      <section class="width1140">
        <div class="right-content">
          <div id="agent-fix" class="fixed-form"></div>
        </div>
      </section>
    </section>
    <div class="mdialog" id="sell-now-form" style="background: none">
      <div class="popup-overlay">
        <div class="title title-res">
            <span> <a class="back-icon cnb-close" href="javascript:void(0)"></a> </span>
          <span class="house-type">Bán, cho thuê nhà với TGNP</span>
        </div>
        <div class="popup-contact">
          <div class="bg-e1e2e6 header">
            Bán, cho thuê nhà với TGNP
          </div>
          <div class="actionIcon cnb-close"></div>
          <div class="form-contact contact-form">
            <div class="contact" id="sell-now-form-body"></div>
          </div>
        </div>
      </div>
    </div>

    <section class="background-gray">
      <section class="width1140 main-content">
        <div class="heading-02 mgt-10">Nhà đất lân cận</div>
        <section class="compare-house">
          {% for listing in listings_neighborhood %}
            {% include "listings/_nearByListing.html" %}
          {% endfor %}
        </section>
      </section>
    </section>
    <section class="bg-gray-e6 pdt-0">
      <section class="width1140">
        <div class="heading-02">Bạn đang cần bán hay cho thuê nhà?</div>
        <div class="ads3d-box pdt-15">
          <div class="ads3d-box-left">
            <div class="promo-3d-vid cover">
              <span data-origin="8IP1dKqq298" class="popup-yt-video">
              <picture>
              <source
                srcset="{% static 'images/service-3dview.png' %}, {% static 'images/service-3dview.png' %} 2x"
                media="(max-width: 374px)">
              <source
                srcset="{% static 'images/service-3dview.png' %}, {% static 'images/service-3dview.png' %} 2x"
                media="(min-width: 375px)">
              <img alt="TGNP 3D View" src="{% static 'images/service-3dview.png' %}"
                   srcset="{% static 'images/service-3dview.png' %}, {% static 'images/service-3dview.png' %} 2x"
                   title="TGNP 3D View">
              </picture>
              </span>
            </div>
            <div class="about-3d">
              <h3>Tuyệt vời khi trình diễn với 3d nhập vai</h3>
              <p>Công nghệ 3d nhập vai của Thế giới Nhà Phố mang lại trải nghiệm có độ tin cậy tuyệt đối
                với khách hàng khi xem trực tuyến ở tất cả mọi nơi. Kết hợp đội ngũ nhân viên được đào tạo chuyên
                nghiệp đã giúp cho tốc độ bán nhanh hơn gấp đôi so với thị trường.</p>
            </div>
          </div>
          <div class="ads3d-box-right">
            <div class="clear">
              <div class="cover">
                <img class="lazy" style="object-fit: cover; object-position: center center"
                     data-src="{% static 'img/logo-ko-chu.svg' %}"
                     alt="thegioinhaphovietnam.com.vn" title="thegioinhaphovietnam.com.vn">
              </div>
              <div class="infoagent">
                <h4>thegioinhaphovietnam.com.vn</h4>
                <p>Hỗ trợ 24/7</p>
                <p>
                  <a class="hotline" href="tel:0971841941" title="hotline">0971 841 941</a>
                </p>
              </div>
            </div>
            <a class="like-button" href="#sell-now-form" title="Liên hệ">Liên hệ</a>
            <input type="hidden" name="contact-agent" value="thegioinhaphovietnam@gmail.com">
            <input type="hidden" name="contact-agent-msg"
                   value="Tôi có nhu cầu muốn bán nhà thông qua TGNP. Liên lạc với tôi ngay.">
          </div>
        </div>
      </section>
    </section>

    <section class="background-gray">
      <div class="width1140">
        <div class="heading-02 pd-tb-30 mgt-10">Nhà đất tương tự</div>
        <div id="similar-property" class="flexslider main-content">
          <div class="slider-buttons">
            <a href="#" title="next"><span class="but-nextdetail-news flex-next"></span> </a>
            <a href="#" title="prev"><span class="but-predetail-news flex-prev flex-disabled" tabindex="-1"></span> </a>
          </div>
          <ul class="exclusive slides">
            {% for listing in listings_same %}
              {% include "listings/_neighbourListing.html" %}
            {% endfor %}
          </ul>
        </div>
      </div>
    </section>

    <div class="post-share-btn-group aj-post-share-btn-group">
      <div class="btn-group btn-share-group addthis_toolbox addthis_default_style">
        <ul class="post-share-buttons">
          <li>
            <a class="addthis_button_facebook kmq-blog-post-share-post facebook-color"> <i
              class="zmdi zmdi-facebook"></i></a>
          </li>
          <li>
            <a class="addthis_button_messenger kmq-blog-post-share-post twitter-color">
              <img width="90%" src="{% static 'images/fb_message.svg' %}"
                   alt="messenger" title="messenger"/>
            </a>
          </li>
          <li>
            <a class="addthis_button_sms kmq-blog-post-share-post in-color"> <i
              class="zmdi zmdi-hc-2x zmdi-comment-text"></i></a>
          </li>
          <li>
            <a class="addthis_button_mailto kmq-blog-post-share-post gray "> <i
              class="zmdi zmdi-hc-2x zmdi-email"></i></a>
          </li>
        </ul>
      </div>
    </div>
    <div id="property-contactbox-v2-app"></div>
    <div id="detailPopupContact">{% include "listings/_detailPopupContactTemplate.html" %}</div>
    {% include "partials/_detailFeedbackForm.html" %}
  </div>

{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script async src="{% static 'js/listing.min90ca.js' %}"></script>


  <script type="deferjs">
    window.$dialog = function(){var e={bodyClassSpecs:"mdialog-body",bodyLoadingClass:"mdialog-loading",cachedBodyStyle:null,default:{zindex:99999,width:300,minHeight:100,background:"rgba(0,0,0,.5)",opacity:.5},key:{cachedStyle:"cached-style"}};return e.show=function(t,n,i,o){(n=$.extend(!0,{outSideClick:!0},n||{})).maxWidth="100%";var a,d=document.body.getAttribute("style");document.body.setAttribute(e.key.cachedStyle,d),(a=t&&"string"==typeof t?$(document.getElementById(t)):t).css("opacity",0),a.css("overflow-y","auto"),a.css("overflow-x","hidden"),a.addClass("opened");var s=(n?n.body:"")||".body";return a.find(s).css(n),a.find(s).addClass(e.bodyClassSpecs),a[0]&&(a[0].$dialogCallback=i),a[0]&&(a[0].$dialogInitTime=+new Date),n&&n.close&&a.find(s+" "+n.close).off().click(function(n){n.preventDefault(),e.hide(t,i)}),n&&n.outSideClick&&a.off().click(function(){e.hide(t,i)}),a.find(s).click(function(e){e.stopPropagation()}),e.animation(a,0,0,1,function(){o&&o()}),e.loadingEnd(a),a},e.animation=function(t,n,i,o,a){t.css("opacity",n),o>0&&n>1||o<0&&n<0?a&&a():setTimeout(function(){n+=o*(.05*i+1e-4*i*i),e.animation(t,n,i+1,o,a)},10)},e.hide=function(t,n){var i;i=t?"string"==typeof t?$(document.getElementById(t)):t:$(".mdialog.opened"),e.animation(i,1,0,-1,function(){i.removeClass("opened"),n&&n(i)})},e.loadingStart=function(t){(t?"string"==typeof t?$(document.getElementById(t)):t:$(".mdialog.opened")).find("."+e.bodyClassSpecs).addClass(e.bodyLoadingClass)},e.loadingEnd=function(t){(t?"string"==typeof t?$(document.getElementById(t)):t:$(".mdialog.opened")).find("."+e.bodyClassSpecs+"."+e.bodyLoadingClass).removeClass(e.bodyLoadingClass)},$(window).keydown(function(t){var n=$(".mdialog.opened");if(n.length&&27==t.keyCode){var i=[];i.length=n.length;for(var o=0;o<n.length;o++)for(var a=o;a<n.length;a++)n[o].$dialogInitTime>n[a].$dialogInitTime?(i[a]=n[o],i[o]=n[a]):(i[o]=n[o],i[a]=n[a]);var d=i[i.length-1];d&&e.hide($(d),d?d.$dialogCallback:null)}}),e.initStyles=function(){var e=document.createElement("STYLE"),t=document.head||document.getElementsByTagName("head")[0];e.type="text/css",e.styleSheet?e.styleSheet.cssText="":e.appendChild(document.createTextNode(this.getCss())),t.appendChild(e)},e.getCss=function(){var t=e.default,n="",i={display:"none",position:"fixed",top:"0",height:"100%",left:"0",width:"100%"};i["z-index"]=t.zindex,i.background=t.background,n+=e.assignStyle(".mdialog",i),n+=".mdialog.opened{display: block;}";var o={};o.width=t.width+"px",o["min-height"]=t.minHeight+"px",o.background="#fff",o.margin="60px auto 140px auto",n+=e.assignStyle(".mdialog .body",o);var a={position:"relative"};n+=e.assignStyle("."+e.bodyLoadingClass,a);var d={content:"' '",top:0,left:0,width:"100%",height:"100%",position:"absolute",background:"#fff",opacity:.4,"z-index":1};n+=e.assignStyle("."+e.bodyLoadingClass+":before",d);var s={content:"' '",border:"2px solid #303339","border-top":"2px solid #fff;","border-radius":"50%",width:"30px",height:"30px",position:"absolute",top:"calc(50% - 15px)",left:"calc(50% - 15px)","-webkit-animation":"spin 2s linear infinite",animation:"spin 2s linear infinite","z-index":1};return n+=e.assignStyle("."+e.bodyLoadingClass+":after",s),n+="@-webkit-keyframes spin { 0% { -webkit-transform: rotate(0deg); } 100% { -webkit-transform: rotate(360deg); } } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }"},e.assignStyle=function(e,t){var n=e+"{";for(var i in t){n+=i+":"+t[i]+";"}return n+="}"},e.initStyles(),e}();

  </script>

  <script>
      /*@shinsenter/defer.js*/
      !function (e, i, t, n, r, o) {
          o = /p/.test(i.readyState);
          var c = 0 <= navigator.userAgent.indexOf('Firefox');

          function f(e, t) {
              o ? n(e, t || 32) : r.push(e, t)
          }

          function a(e, t, n, r) {
              return t && i.getElementById(t) || (r = i.createElement(e || 'SCRIPT'), t && (r.id = t), n && (r.onload = n), i.head.appendChild(r)), r || {}
          }

          e.addEventListener('on' + t in e ? t : 'load', function () {
              for (o = 1; r[0];) f(r.shift(), r.shift())
          }), f._ = a, e.defer = f, e.deferscript = function (e, t, n, r) {
              f(function () {
                  a('', t, r).src = e
              }, n)
          }, e.deferPreload = function (e, t) {
              if (t = t || 'script', c) {
                  var n = i.createElement('object');
                  n.data = e, n.width = 0, n.height = 0, i.body.append(n)
              } else {
                  var r = i.createElement('link');
                  r.setAttribute('rel', 'preload'), r.href = e, r.as = t, i.head.append(r)
              }
          }
      }(this, document, 'pageshow', setTimeout, []), function (s, n) {
          var u = 'IntersectionObserver', d = 'lazied', l = 'data-', h = l + d, p = 'load', m = 'forEach',
              y = 'getAttribute', v = 'setAttribute', b = Function(), g = s.defer || b, f = g._ || b;

          function E(e, t) {
              return [].slice.call((t || n).querySelectorAll(e))
          }

          function e(a) {
              return function (e, t, i, o, c, f) {
                  g(function (n, t) {
                      function r(n) {
                          !1 !== (o || b).call(n, n) && ((f || ['srcset', 'src', 'style'])[m](function (e, t) {
                              (t = n[y](l + e)) && n[v](e, t)
                          }), E('SOURCE', n)[m](r), p in n && n[p]()), n.className += ' ' + (i || d)
                      }

                      t = u in s ? (n = new s[u](function (e) {
                          e[m](function (e, t) {
                              e.isIntersecting && (t = e.target) && (n.unobserve(t), r(t))
                          })
                      }, c)).observe.bind(n) : r, E(e || a + '[' + l + 'src]:not([' + h + '])')[m](function (e) {
                          e[y](h) || (e[v](h, a), t(e))
                      })
                  }, t)
              }
          }

          function t() {
              g(function (t, n, r, i, o) {
                  function c(e, t) {
                      for (i in t = t || !1, e.parentNode.removeChild(e), e.removeAttribute('type'), n = f(e.nodeName), t && (n.async = 1), e) 'string' == typeof (o = e[i]) && n[i] != o && (n[i] = o);
                      return n
                  }

                  t = E((r = '[type=deferjs]') + ':not(' + (i = '[async]') + ')'), E(r + i).forEach(function (e) {
                      c(e, !0)
                  }), t.forEach(function (e) {
                      e.src && s.deferPreload(e.src)
                  }), function e() {
                      0 != t && (r = t.shift(), n = c(r), r.src ? n.onload = n.onerror = e : g(e, .1))
                  }()
              }, 4)
          }

          t(), s.deferstyle = function (t, n, e, r) {
              g(function (e) {
                  (e = f('LINK', n, r)).rel = 'stylesheet', e.href = t
              }, e)
          }, s.deferimg = e('IMG'), s.deferiframe = e('IFRAME'), g.all = t
      }(this, document);
  </script>

  <script>deferscript('https://cdn.jsdelivr.net/npm/@shinsenter/defer.js@1.1.7/dist/polyfill.min.js', 'polyfill-js', 1)</script>

  <script>
      function objValue(obj, is, value) { //Access 1 object bằng key
          if (typeof is == 'string')
              return objValue(obj, is.split('.'), value);
          else if (is.length == 1 && value !== undefined)
              return obj[is[0]] = value;
          else if (is.length == 0)
              return obj;
          else if (typeof obj === "undefined")
              return undefined
          else
              return objValue(obj[is[0]], is.slice(1), value);
      }

      function waitFor(objAcc, callback, timeout) {
          if (typeof callback !== "function") {
              return
          }
          timeout = timeout || 0
          var startTime = new Date().getTime()

          function check() {
              if (typeof objValue(window, objAcc) !== "undefined") {
                  callback()
              } else {
                  if (timeout > 0 && new Date().getTime() - startTime > timeout) { //Vượt quá timeout
                      console.error("wait for " + objAcc + " has timeout!")
                  } else {
                      setTimeout(check, 500)
                  }
              }
          }

          check()
      }

      function applyImageLazyLoad(scope) {
          scope = scope || document
          var lazyImages = [].slice.call(scope.querySelectorAll("img.lazy"));

          if ("IntersectionObserver" in window) {
              let ops = {
                  rootMargin: "450px",
                  threshold: 0.1
              }

              let lazyImageObserver = new IntersectionObserver(function (entries, observer) {
                  entries.forEach(function (entry) {
                      if (entry.isIntersecting) {
                          let lazyImage = entry.target;
                          lazyImage.src = lazyImage.dataset.src;
                          if (!!lazyImage.dataset.srcset) {
                              lazyImage.srcset = lazyImage.dataset.srcset;
                          }
                          lazyImage.classList.remove("lazy");
                          lazyImageObserver.unobserve(lazyImage);
                      }
                  });
              }, ops);

              lazyImages.forEach(function (lazyImage) {
                  lazyImageObserver.observe(lazyImage);
              });

              //Lazy for background
              var lazyBackgrounds = [].slice.call(scope.querySelectorAll(".lazy-background"));
              let lazyBackgroundObserver = new IntersectionObserver(function (entries, observer) {
                  entries.forEach(function (entry) {
                      if (entry.isIntersecting) {
                          entry.target.classList.add("visible");
                          entry.target.classList.remove("lazy-background");
                          lazyBackgroundObserver.unobserve(entry.target);
                      }
                  });
              }, ops);
              lazyBackgrounds.forEach(function (lazyBackground) {
                  lazyBackgroundObserver.observe(lazyBackground);
              });
          } else { //Không support observer
              let lazyImages = [].slice.call(scope.querySelectorAll("img.lazy"));
              let active = false;

              const lazyLoad = function () {
                  if (active === false) {
                      active = true;

                      setTimeout(function () {
                          lazyImages.forEach(function (lazyImage) {
                              if ((lazyImage.getBoundingClientRect().top <= window.innerHeight && lazyImage.getBoundingClientRect().bottom >= 0) && getComputedStyle(lazyImage).display !== "none") {
                                  lazyImage.src = lazyImage.dataset.src;
                                  lazyImage.srcset = lazyImage.dataset.srcset;
                                  lazyImage.classList.remove("lazy");

                                  lazyImages = lazyImages.filter(function (image) {
                                      return image !== lazyImage;
                                  });

                                  if (lazyImages.length === 0) {
                                      document.removeEventListener("scroll", lazyLoad);
                                      window.removeEventListener("resize", lazyLoad);
                                      window.removeEventListener("orientationchange", lazyLoad);
                                  }
                              }
                          });

                          active = false;
                      }, 200);
                  }
              };

              document.addEventListener("scroll", lazyLoad);
              window.addEventListener("resize", lazyLoad);
              window.addEventListener("orientationchange", lazyLoad);
          }
      }

      document.addEventListener("DOMContentLoaded", function () {
          applyImageLazyLoad(document)
      });
  </script>
  <script>
      window['isListing'] = true;
      window['favorite_api'] = 'api/favorite';
  </script>



  {#  <script type="deferjs" src="{% static 'js/hubspot-chatbox.min90ca.js' %}"></script>#}
  <script async type="text/javascript" src="{% static 'js/property-contact-box.js' %}"></script>

  <script type="deferjs">
    var addthis_share = {
       url: window.location.href
    }

  </script>
  <script defer src="{% static 'js/favorite.min90ca.js' %}"></script>
  <script defer src="{% static 'js/home-recent-view.min90ca.js' %}"></script>
  <script defer src="{% static 'js/addthis_widget.js' %}"></script>

  <script type="deferjs">
  function setupViewMore(heightLimit, $itemsWrapper, $items, $viewMoreWrapper, $viewMoreLink){
    var isCollapse = false
    var itemHeight = $items.height()
    $itemsWrapper.css("box-sizing", "content-box")
    $viewMoreLink.click(function () {
      if(!isCollapse){
        showMore()
      }else{
        hide()
      }
    })

    function showMore(){
      isCollapse = true
      $viewMoreLink.html('Thu gọn<i class="zmdi zmdi-chevron-up zmdi-hc-fw"></i>')
      //$itemsWrapper.css('height', 'auto')
      $itemsWrapper.animate({height: itemHeight + "px"}, 500)
    }

    function hide(){
      isCollapse = false
      $viewMoreLink.html('Xem thêm<i class="zmdi zmdi-chevron-down zmdi-hc-fw"></i>')
      //$itemsWrapper.css('height', heightLimit + 'px')
      $itemsWrapper.animate({height: heightLimit + "px"}, 500)
    }

    if(itemHeight > heightLimit){
      $viewMoreWrapper.show()
    }else{
      $itemsWrapper.css('height', itemHeight + "px")
    }
  }

  var publicFacEle = {
    wrapper: $("#public-facilities .items"),
    items: $("#public-facilities .items ul"),
    viewMore: $("#public-facilities .view-more-wrapper"),
    viewMoreLink: $("#public-facilities .view-more-wrapper a")
  }
  $(document).ready(function(){
    setupViewMore(114, publicFacEle.wrapper, publicFacEle.items, publicFacEle.viewMore, publicFacEle.viewMoreLink)
  })



  </script>

  <script type="deferjs">
  (function () {
    var formQueue = [];

    function queuedForm(opt) {

        formQueue.push(opt);
      }
    }

    var awaitTimeout = 0;
    var awaitHSForm = function () {
      awaitHSForm.called = true;
      if (formQueue && hbspt && hbspt.forms && hbspt.forms.deps) {
        formQueue.forEach(function (_opt) {
          hbspt.forms.create(_opt);
        });
        clearTimeout(awaitTimeout);
        delete formQueue;
      } else {
        awaitTimeout = setTimeout(awaitHSForm, 500);
      }
    };
    window['hbspt'] = {
      forms: {
        create: function (opt) {
          if (!awaitHSForm.called) {
            awaitHSForm();
          }
          queuedForm(opt);
        }
      }
    };
  })();



  </script>
  {% comment %}  <script charset="utf-8" type="deferjs" src="https://js.hsforms.net/forms/v2.js"></script>{% endcomment %}
  <script type="deferjs">
  function createHSForm(opt) {
    function getClientId() {
      try {
        return ga.getAll()[0].get('clientId');
      } catch (e) {
        return ""
      }
    }

    var optFS = opt['onFormSubmit'];
    var defaultOpt = Object.create(opt);
    defaultOpt.onFormSubmit = function () {
      var $gaClientId = $('[name=ga_client_id]');
      if ($gaClientId[0]) {
        $gaClientId.val(getClientId());
      }
      if (typeof optFS === 'function') {
        optFS.apply(this, arguments)
      }
    };
    return hbspt.forms.create(defaultOpt);
  }
  var dialogManager = (function DialogService() {
    var fact = this;
    fact.bodyClassSpecs = "mdialog-body";
    fact.bodyLoadingClass = "mdialog-loading";
    fact.cachedBodyStyle = null;
    fact.default = {
      zindex: 99999,
      width: 300,
      minHeight: 100,
      background: "rgba(0,0,0,.5)",
      opacity: 0.5
    };
    fact.key = {
      cachedStyle: "cached-style"
    };
    var v0 = 0.05;
    var a = 0.0002;
    fact.show = function (selectorId, options, hideFn, showFn) {
      options = $.extend(true, {
        outSideClick: true
      }, options || {});
      options.maxWidth = "100%";
      var dialog, oldStyle = document.body.getAttribute("style");
      document.body.setAttribute(fact.key.cachedStyle, oldStyle);
      if (selectorId && typeof selectorId === 'string') {
        dialog = $(document.getElementById(selectorId));
      } else {
        dialog = selectorId;
      }
      dialog.css("opacity", 0);
      dialog.css("overflow-y", "auto");
      dialog.css("overflow-x", "hidden");
      dialog.addClass("opened");
      var bodyClass = (options ? options.body : "") || ".body";
      dialog.find(bodyClass).css(options);
      dialog.find(bodyClass).addClass(fact.bodyClassSpecs)
      dialog[0] ? dialog[0]["$dialogCallback"] = hideFn : null;
      dialog[0] ? dialog[0]["$dialogInitTime"] = +new Date() : null;
      if (options && options.close) {
        dialog.find(bodyClass + " " + options.close).off().click(function (e) {
          e.preventDefault();
          fact.hide(selectorId, hideFn);
        });
      }
      if (options && options.outSideClick) {
        dialog.off().click(function () {
          fact.hide(selectorId, hideFn);
        });
      }
      dialog.find(bodyClass).click(function (e) {
        e.stopPropagation();
      });
      //.preventParentScroll();
      fact.animation(dialog, 0, 0, 1, function () {
        showFn ? showFn() : null;
      });
      fact.loadingEnd(dialog);
      return dialog;
    };
    fact.animation = function (dialog, opa, t, delta, callback) {
      dialog.css("opacity", opa);
      if ((delta > 0 && opa > 1) || (delta < 0 && opa < 0)) {
        if (callback) {
          callback();
        }
        return;
      }
      setTimeout(function () {
        opa += delta * (v0 * t + 1 / 2 * a * t * t);
        fact.animation(dialog, opa, t + 1, delta, callback);
      }, 10);
    };
    fact.hide = function (selectorId, fn) {
      var dialog;
      if (!selectorId) {
        dialog = $(".mdialog.opened");
      } else if (typeof selectorId === 'string') {
        dialog = $(document.getElementById(selectorId));
      } else {
        dialog = selectorId;
      }
      fact.animation(dialog, 1, 0, -1, function () {
        dialog.removeClass("opened");
        fn ? fn(dialog) : null;
      });
    };
    fact.loadingStart = function (selectorId) {
      var dialog;
      if (!selectorId) {
        dialog = $(".mdialog.opened");
      } else if (typeof selectorId === 'string') {
        dialog = $(document.getElementById(selectorId));
      } else {
        dialog = selectorId;
      }
      dialog.find("." + fact.bodyClassSpecs).addClass(fact.bodyLoadingClass);
    };
    fact.loadingEnd = function (selectorId) {
      var dialog;
      if (!selectorId) {
        dialog = $(".mdialog.opened");
      } else if (typeof selectorId === 'string') {
        dialog = $(document.getElementById(selectorId));
      } else {
        dialog = selectorId;
      }
      dialog.find("." + fact.bodyClassSpecs + "." + fact.bodyLoadingClass).removeClass(fact.bodyLoadingClass);
    };
    $(window).keydown(function (e) {
      var openedDialog = $(".mdialog.opened");
      if (openedDialog.length && e.keyCode == 27) {
        var arr = [];
        arr.length = openedDialog.length;
        for (var i = 0; i < openedDialog.length; i++) {
          for (var j = i; j < openedDialog.length; j++) {
            if (openedDialog[i]["$dialogInitTime"] > openedDialog[j]["$dialogInitTime"]) {
              arr[j] = openedDialog[i];
              arr[i] = openedDialog[j];
            } else {
              arr[i] = openedDialog[i];
              arr[j] = openedDialog[j];
            }
          }
        }
        var lastedOpen = arr[arr.length - 1];
        if (lastedOpen) {
          fact.hide($(lastedOpen), lastedOpen ? lastedOpen["$dialogCallback"] : null);
        }
      }
    });
    fact.initStyles = function () {
      var css = "";
      var style = document.createElement("STYLE");
      var head = document.head || document.getElementsByTagName("head")[0];
      style.type = "text/css";
      if (style.styleSheet) {
        style.styleSheet.cssText = css;
      } else {
        style.appendChild(document.createTextNode(this.getCss()));
      }
      head.appendChild(style);
    };
    fact.getCss = function () {
      var options = fact.default;
      var css = "";
      var dialog = {};
      dialog["display"] = "none";
      dialog["position"] = "fixed";
      dialog["top"] = "0";
      dialog["height"] = "100%";
      dialog["left"] = "0";
      dialog["width"] = "100%";
      dialog["z-index"] = options.zindex;
      dialog["background"] = options.background;
      css += fact.assignStyle(".mdialog", dialog);
      css += ".mdialog.opened{display: block;}";
      var body = {};
      body["width"] = options.width + "px";
      body["min-height"] = options.minHeight + "px";
      body["background"] = "#fff";
      body["margin"] = "60px auto 140px auto";
      css += fact.assignStyle(".mdialog .body", body);
      var bodySpecs = {};
      bodySpecs["position"] = "relative"
      css += fact.assignStyle("." + fact.bodyLoadingClass, bodySpecs);
      var loadingFrame = {};
      loadingFrame["content"] = "' '";
      loadingFrame["top"] = 0;
      loadingFrame["left"] = 0;
      loadingFrame["width"] = "100%";
      loadingFrame["height"] = "100%";
      loadingFrame["position"] = "absolute";
      loadingFrame["background"] = "#fff";
      loadingFrame["opacity"] = 0.4;
      loadingFrame["z-index"] = 1;
      css += fact.assignStyle("." + fact.bodyLoadingClass + ":before", loadingFrame);
      var loading = {};
      loading["content"] = "' '";
      loading["border"] = "2px solid #303339";
      loading["border-top"] = "2px solid #fff;";
      loading["border-radius"] = "50%";
      loading["width"] = "30px";
      loading["height"] = "30px";
      loading["position"] = "absolute";
      loading["top"] = "calc(50% - 15px)";
      loading["left"] = "calc(50% - 15px)";
      loading["-webkit-animation"] = "spin 2s linear infinite";
      loading["animation"] = "spin 2s linear infinite";
      loading["z-index"] = 1;
      css += fact.assignStyle("." + fact.bodyLoadingClass + ":after", loading);
      css += "@-webkit-keyframes spin { 0% { -webkit-transform: rotate(0deg); } 100% { -webkit-transform: rotate(360deg); } } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }";
      return css;
    };
    fact.assignStyle = function (name, cssobj) {
      var res = name + "{";
      for (var key in cssobj) {
        var val = cssobj[key];
        res += key + ":" + val + ";";
      }
      res += "}";
      return res;
    };
    fact.initStyles();
    return fact;
  })();

  if (!window['showDialog']) {
    window['showDialog'] = function (id, closeClass, bodyClass) {
      dialogManager.show("contact-now", {
        close: closeClass,
        body: bodyClass
      }, function hideFn() {
      }, function showFn(dialog) {
        $('#' + id).find("input").first().focus();
        $(bodyClass).css("max-width", "").css("width", "100%")
            .find(".popup-contact").scrollTop(0);
      });
    }
  }

  </script>
  <script type="deferjs">
        createHSForm({
            css: '',
            target: '#sell-now-form-body',
            portalId: '2775524',
            formId: '9cc2fa2e-59d1-410a-a910-217a24437963',
            onFormReady: function($form){
                $form.on("submit", function(e){
                    goog_report_conversion ? goog_report_conversion() : null;
                });
            }
        });

  </script>

  <script defer src="{% static 'js/header-v2.min90ca.js' %}"></script>
  {% if listing.videos %}
    <link href="//vjs.zencdn.net/7.10.2/video-js.min.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="//vjs.zencdn.net/7.10.2/video.min.js"></script>
    <script type="text/javascript" src="{% static 'js/video.min.js' %}"></script>
  {% endif %}"

{% endblock %}
